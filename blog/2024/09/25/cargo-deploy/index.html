<!DOCTYPE html>
<html lang="en-EN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="keyword 1, keyword 2, keyword 3" name="keywords">
<meta content="CryptoPatrick" name="author">
<meta property="og:title" content="ðŸ¦€ Cargo Deploy - Seamless Global Nature">
<meta property="og:url" content="https://www.cryptopatrick.com/blog/2024/09/25/cargo-deploy/">
<meta property="og:description" content="">
<meta property="og:type" content="website" />


<meta property="og:image" content="https://www.cryptopatrick.com/img/post-name/name.jpg" />


<title>ðŸ¦€ Cargo Deploy | Seamless Global Nature</title>

<link rel="stylesheet" href="https://www.cryptopatrick.com//css/style.css">
<link rel="stylesheet" href="https://www.cryptopatrick.com//css/customcode.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">

 <img src="../../../../../profile.jpg" alt="Avatar" style="margin-right: 1em" height="100px">
      <div class="nav-left" style="flex-basis: auto;">
        <a class="nav-item" href="https://www.cryptopatrick.com/"><h1 class="title is-4">Seamless Global Nature</h1></a>
      <nav class="nav-item level is-mobile">
          
          
          <a class="level-item" href="https://www.cryptopatrick.com/about/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-male"></i>
            </span>
            
            About Me
          </a>
          
          <a class="level-item" href="https://www.cryptopatrick.com/tags/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-tags"></i>
            </span>
            
            Tags
          </a>
          
          <a class="level-item" href="https://100-days-of-vibe.vercel.app" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-paper-plane"></i>
            </span>
            
            100DaysOfVibe
          </a>
          
          <a class="level-item" href="https://x.com/cryptopatrick" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-twitter"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://github.com/cryptopatrick?tab=repositories" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-github"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://www.instagram.com/cryptopatrickk/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-instagram"></i>
            </span>
            
             
          </a>
          
        </nav>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">ðŸ¦€ Cargo Deploy</h1>
    
    
    <h2 class="subtitle is-5">
      September 25, 2024
       by CryptoPatrick
      
        
        <span class="tags-inline" style="margin-left:0.1em;">
          
            
            <a class="tag is-link is-light" href="../../../../../tags/engineering/" style="margin-left:0.25em;">Engineering</a>
          
            
            <a class="tag is-link is-light" href="../../../../../tags/rust/" style="margin-left:0.25em;">Rust</a>
          
        </span>
      
      
    </h2>
    <div class="content">
      <p>In this post we&rsquo;ll create our own third-party cargo subcommand, <code>cargo deploy</code>. When we call our command in a Rust project, the command will send a binary to our server at Netlify, and print out the URL in the command line.
Let&rsquo;s get started.</p>
<h2 id="naming">Naming</h2>
<p>The binary of our command needs to be named <code>cargo-${command}</code>. In our case we&rsquo;ll name it <code>cargo-deploy</code>.</p>
<h2 id="placement">Placement</h2>
<p>The binary of our command needs to be stored in <code>~/.cargo/bin</code>.
There&rsquo;s an easy way to do this: we simply create the binary (named <code>cargo-deploy</code>) and then <strong>publish</strong> it to <code>crates.io</code>.
Then, <code>cargo install cargo-deploy</code> will download and place the binary in <code>~/.cargo/bin</code>.</p>
<p><code>cargo-deploy</code> also needs an <strong>HTTP client</strong> to make requests against our API, as well as some <strong>config logic to hold API keys</strong>. Finally, <code>cargo-deploy</code> needs to use the cargo crate to programmatically run cargo commands like <code>cargo package</code>.</p>
<h2 id="how-it-works">How it works</h2>
<p><code>cargo deploy</code> runs <code>cargo package</code> under the hood, zipping up the current cargo project into a <em>tarball</em> and <em>shipping</em> it to our API under the <code>/deploy</code> endpoint with a bearer token for authentication.</p>
<ol>
<li>
<p>The API receives the tarball and holds it in memory. The build is added to a job processor which acts as a build queue.</p>
</li>
<li>
<p>The job processor unpacks the tarball and writes it to disk, say under <code>/projects/my-app</code>. The build system is triggered to compile the unpacked cargo project.</p>
</li>
<li>
<p>The output of the build process is a shared object file (<code>.so</code>) which is then dynamically loaded by the API with its own runtime. The newly born web server is assigned a free port which is not exposed to the outside world.</p>
</li>
<li>
<p>We update the routing table of our reverse proxy such that requests coming in with the host <code>my-app.shuttleapp.rs</code> are forwarded to the aforementioned port.</p>
</li>
</ol>




    </div>
    
    
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>'I write to understand as much as to be understood.' â€”Elie Wiesel<br> (c) 2024 CryptoPatrick</p>
  </div>
</section>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




</body>
