<!DOCTYPE html>
<html lang="en-EN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="keyword 1, keyword 2, keyword 3" name="keywords">
<meta content="CryptoPatrick" name="author">
<meta property="og:title" content="ðŸ¦€ Const Generics - Seamless Global Nature">
<meta property="og:url" content="https://www.cryptopatrick.com/blog/2024/12/06/const-generics/">
<meta property="og:description" content="">
<meta property="og:type" content="website" />


<meta property="og:image" content="https://www.cryptopatrick.com/img/post-name/name.jpg" />


<title>ðŸ¦€ Const Generics | Seamless Global Nature</title>

<link rel="stylesheet" href="https://www.cryptopatrick.com//css/style.css">
<link rel="stylesheet" href="https://www.cryptopatrick.com//css/customcode.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">

 <img src="../../../../../profile.jpg" alt="Avatar" style="margin-right: 1em" height="100px">
      <div class="nav-left" style="flex-basis: auto;">
        <a class="nav-item" href="https://www.cryptopatrick.com/"><h1 class="title is-4">Seamless Global Nature</h1></a>
      <nav class="nav-item level is-mobile">
          
          
          <a class="level-item" href="https://www.cryptopatrick.com/about/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-male"></i>
            </span>
            
            About Me
          </a>
          
          <a class="level-item" href="https://www.cryptopatrick.com/tags/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-tags"></i>
            </span>
            
            Tags
          </a>
          
          <a class="level-item" href="https://100-days-of-vibe.vercel.app" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-paper-plane"></i>
            </span>
            
            100DaysOfVibe
          </a>
          
          <a class="level-item" href="https://x.com/cryptopatrick" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-twitter"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://github.com/cryptopatrick?tab=repositories" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-github"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://www.instagram.com/cryptopatrickk/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-instagram"></i>
            </span>
            
             
          </a>
          
        </nav>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">ðŸ¦€ Const Generics</h1>
    
    
    <h2 class="subtitle is-5">
      December 6, 2024
       by CryptoPatrick
      
        
        <span class="tags-inline" style="margin-left:0.1em;">
          
            
            <a class="tag is-link is-light" href="../../../../../tags/programming/" style="margin-left:0.25em;">programming</a>
          
            
            <a class="tag is-link is-light" href="../../../../../tags/rust/" style="margin-left:0.25em;">rust</a>
          
        </span>
      
      
    </h2>
    <div class="content">
      <h1 id="goldmoon---the-3rd-level-magician">Goldmoon - The 3rd Level Magician</h1>
<p>It&rsquo;s Friday night. You and a group of friends are playing the role-playing game, Dungeons &amp; Dragons. Your character, Goldmoon, is a 3rd level Magic User.
Goldmoon, like any magician, has the power to cast magic spells.</p>
<h1 id="limitations">Limitations</h1>
<p>The number of spells that she can memorize is limited. The power of her spells is also constrained by her level (she has attained 3rd level magic user).
Higher level, more powerful, spells demand more preparation and memory than lower level spells.</p>
<p>According to the official Dungeons &amp; Dragons rulebook, Goldmoon, at her level (3rd) can memorize the following number of spells per level:</p>
<ul>
<li>1st-level spells: 4</li>
<li>2nd-level spells: 2</li>
</ul>
<p>This means that Goldmoon cannot memorize and cast &mdash;, a 3rd-level spell.
She&rsquo;s simply not powerful enough, yet.</p>
<p>Once Goldmoon reaches the 4th level, her spell casting abilities will grow to look like this:</p>
<ul>
<li>1st-level spells: 4</li>
<li>2nd-level spells: 2</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#434f54">enum</span> <span style="color:#434f54">FirstLevelSpells</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">CharmPerson</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">DetectMagic</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">FloatingDisc</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">HoldPortal</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Light</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">MagicMissile</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">ProtectionFromEvil</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">ReadLanguages</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">ReadMagic</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Shield</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">enum</span> <span style="color:#434f54">SecondLevelSpells</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">ContinualLight</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">DetectEvil</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">DetectInvisible</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">ESP</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Invisibility</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Knock</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Levitate</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">LocateObject</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">MirrorImage</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">PhantasmalForce</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">Web</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">WizardLock</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">struct</span> <span style="color:#434f54">SpellBook</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">spells</span><span style="color:#728e00">:</span> <span style="color:#00979d">Vec&lt;</span><span style="color:#728e00">[</span><span style="color:#00979d">FirstLevel</span><span style="color:#a61717">;</span> <span style="color:#00979d">const</span> <span style="color:#00979d">N:</span> <span style="color:#00979d">usize</span><span style="color:#728e00">],</span> <span style="color:#728e00">[</span><span style="color:#00979d">SecondLevel</span><span style="color:#a61717">;</span> <span style="color:#00979d">const</span> <span style="color:#00979d">N:</span> <span style="color:#00979d">usize</span><span style="color:#728e00">]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">fn</span> <span style="color:#434f54">main</span><span style="color:#728e00">()</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">let</span> <span style="color:#434f54">gooldmoon</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">let</span> <span style="color:#434f54">mut</span> <span style="color:#434f54">memorize_spells</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Vec</span><span style="color:#728e00">&lt;[</span><span style="color:#00979d">FirstLevel</span><span style="color:#a61717">;</span> <span style="color:#a61717">4</span><span style="color:#728e00">],</span> <span style="color:#728e00">[</span><span style="color:#00979d">SecondLevel</span>, <span style="color:#a61717">2</span><span style="color:#728e00">]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">}</span>
</span></span></code></pre></div><p>To cast a 1st-level spell like Magic Missile, the wizard uses one 1st-level slot. For a 2nd-level spell like Mirror Image, a 2nd-level slot is used.</p>
<hr>
<h2 id="array-of-pain">Array of Pain</h2>
<p>Handling arrays in Rust can be somewhat painful. The reason is:</p>
<ol>
<li>First, arrays are fixed-length: once declared, the length of an array cannot be changed.</li>
<li>Second, arrays are typed based on their length <em>and</em> the type of their elements (which can only be of one type).</li>
</ol>
<p>Arrays were only considered to be of the same type if they had both the same <code>size</code> <em>and</em> the same type of <code>element</code>.
Before <code>const generics</code>, working with arrays in Rust could be painful.</p>
<h2 id="const-generics-to-the-rescue">Const Generics to the rescue</h2>
<p>Const Generics, which dropped in Stable version 1.83, enable us to define a generic over a constant value, like the length of an array.
This is useful because quivers are fixed-size arrays.</p>
<blockquote>
<p>There are three types of generics in ðŸ¦€ Rust: <code>LifetimeParam</code>, <code>TypeParam</code>, and <code>ConstParam</code>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#434f54">let</span> <span style="color:#434f54">quiver</span> <span style="color:#728e00">=</span> <span style="color:#728e00">[</span><span style="color:#00979d">WoodenArrow</span><span style="color:#a61717">;</span> <span style="color:#a61717">10</span><span style="color:#728e00">];</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">let</span> <span style="color:#434f54">quiver</span> <span style="color:#728e00">=</span> <span style="color:#728e00">[</span><span style="color:#00979d">WoodenArrow</span><span style="color:#a61717">;</span> <span style="color:#a61717">11</span><span style="color:#728e00">];</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">let</span> <span style="color:#434f54">quiver</span> <span style="color:#728e00">=</span> <span style="color:#728e00">[</span><span style="color:#00979d">SilverTipArrow</span><span style="color:#a61717">;</span> <span style="color:#a61717">10</span><span style="color:#728e00">];</span>
</span></span></code></pre></div><p>Here&rsquo;s our first problem.
But like any container, the capacity (size) of the quiver can vary.
We want to create a <em>generic</em> <code>trait</code> that will apply to any arrow quiver, regardless of its capacity.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#95a5a6">// Only array_a and array_d are of the same type.
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span><span style="color:#434f54">struct</span> <span style="color:#434f54">ElfArcher</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">array_a</span><span style="color:#728e00">:</span> <span style="color:#a61717">[</span><span style="color:#00979d">u8</span><span style="color:#728e00">;</span> <span style="color:#8a7b52">5</span><span style="color:#a61717">]</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">array_b</span><span style="color:#728e00">:</span> <span style="color:#a61717">[</span><span style="color:#00979d">u8</span><span style="color:#728e00">;</span> <span style="color:#8a7b52">6</span><span style="color:#a61717">]</span><span style="color:#728e00">,</span> <span style="color:#95a5a6">// larger than array_a, so different type
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">array_c</span><span style="color:#728e00">:</span> <span style="color:#a61717">[</span><span style="color:#00979d">i8</span><span style="color:#728e00">;</span> <span style="color:#8a7b52">5</span><span style="color:#a61717">]</span><span style="color:#728e00">,</span> <span style="color:#95a5a6">// elements of different type, so different type
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">array_d</span><span style="color:#728e00">:</span> <span style="color:#a61717">[</span><span style="color:#00979d">u8</span><span style="color:#728e00">;</span> <span style="color:#8a7b52">5</span><span style="color:#a61717">]</span><span style="color:#728e00">,</span> <span style="color:#95a5a6">// same type as array_a
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span><span style="color:#728e00">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#95a5a6">// The keyword `const` below is what we use to inform the Rust compiler that we
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6">// want to use a const generic for N (which is of type usize).
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6">// Note! We have to use usize because Rust uses it to index arrays.
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span><span style="color:#434f54">struct</span> <span style="color:#434f54">Warrior</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">T</span><span style="color:#728e00">,</span> <span style="color:#434f54">const</span> <span style="color:#434f54">N</span><span style="color:#728e00">:</span> <span style="color:#00979d">usize&gt;</span> <span style="color:#728e00">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00979d">array_a:</span> <span style="color:#728e00">[</span><span style="color:#00979d">T</span><span style="color:#a61717">;</span> <span style="color:#00979d">N</span><span style="color:#728e00">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">array_b</span><span style="color:#728e00">:</span> <span style="color:#a61717">[</span><span style="color:#00979d">T</span><span style="color:#728e00">;</span> <span style="color:#434f54">N</span><span style="color:#a61717">]</span><span style="color:#728e00">,</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">}</span>
</span></span></code></pre></div><h2 id="trait-pains">Trait Pains</h2>
<p>What if we want to implement a <code>trait</code> for these arrays? With const generics, we can now implement traits that work across arrays of different sizes, as long as they contain the same element type.</p>
<blockquote>
<p><code>const generics</code> can be used for other things but solving the previous pain of working with arrays was the main contribution.</p>
</blockquote>




    </div>
    
    
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>'I write to understand as much as to be understood.' â€”Elie Wiesel<br> (c) 2024 CryptoPatrick</p>
  </div>
</section>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




</body>
