<!DOCTYPE html>
<html lang="en-EN">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=60544&amp;path=livereload" data-no-instant defer></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="keyword 1, keyword 2, keyword 3" name="keywords">
<meta content="CryptoPatrick" name="author">
<meta property="og:title" content="ü¶Ä Everydays: ClarISSa (Beth Ann Hockey and Maney) - Seamless Global Nature">
<meta property="og:url" content="http://localhost:60544/blog/2025/08/15/everydays-clarissa-beth-ann-hockey-and-maney/">
<meta property="og:description" content="">
<meta property="og:type" content="website" />


<meta property="og:image" content="http://localhost:60544/img/post-name/name.jpg" />


<title>ü¶Ä Everydays: ClarISSa (Beth Ann Hockey and Maney) | Seamless Global Nature</title>

<link rel="stylesheet" href="http://localhost:60544//css/style.css">
<link rel="stylesheet" href="http://localhost:60544//css/customcode.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">

 <img src="../../../../../profile.jpg" alt="Avatar" style="margin-right: 1em" height="100px">
      <div class="nav-left" style="flex-basis: auto;">
        <a class="nav-item" href="http://localhost:60544/"><h1 class="title is-4">Seamless Global Nature</h1></a>
      <nav class="nav-item level is-mobile">
          
          
          <a class="level-item" href="http://localhost:60544/about/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-male"></i>
            </span>
            
            About Me
          </a>
          
          <a class="level-item" href="http://localhost:60544/tags/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-tags"></i>
            </span>
            
            Tags
          </a>
          
          <a class="level-item" href="https://100-days-of-vibe.vercel.app" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-paper-plane"></i>
            </span>
            
            100DaysOfVibe
          </a>
          
          <a class="level-item" href="https://x.com/cryptopatrick" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-twitter"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://github.com/cryptopatrick?tab=repositories" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-github"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://www.instagram.com/cryptopatrickk/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-instagram"></i>
            </span>
            
             
          </a>
          
        </nav>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">ü¶Ä Everydays: ClarISSa (Beth Ann Hockey and Maney)</h1>
    
    
    <h2 class="subtitle is-5">
      August 15, 2025
       by CryptoPatrick
      
        
        <span class="tags-inline" style="margin-left:0.1em;">
          
            
            <a class="tag is-link is-light" href="../../../../../tags/everydays/" style="margin-left:0.25em;">Everydays</a>
          
            
            <a class="tag is-link is-light" href="../../../../../tags/rust/" style="margin-left:0.25em;">Rust</a>
          
        </span>
      
      
    </h2>
    <div class="content">
      <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>realtime-makepad/
</span></span><span style="display:flex;"><span>‚îú‚îÄ Cargo.toml
</span></span><span style="display:flex;"><span>‚îî‚îÄ src/
</span></span><span style="display:flex;"><span>   ‚îî‚îÄ main.rs
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[<span style="color:#728e00">package</span>]
</span></span><span style="display:flex;"><span><span style="color:#728e00">name</span> = <span style="color:#7f8c8d">&#34;realtime-makepad&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">version</span> = <span style="color:#7f8c8d">&#34;0.1.0&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">edition</span> = <span style="color:#7f8c8d">&#34;2021&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>[<span style="color:#728e00">dependencies</span>]
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Makepad core crates (pull from the official repo to keep APIs in sync)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">makepad-widgets</span> = { <span style="color:#728e00">git</span> = <span style="color:#7f8c8d">&#34;https://github.com/makepad/makepad&#34;</span>, <span style="color:#728e00">package</span> = <span style="color:#7f8c8d">&#34;makepad-widgets&#34;</span> }
</span></span><span style="display:flex;"><span><span style="color:#728e00">makepad-draw</span>    = { <span style="color:#728e00">git</span> = <span style="color:#7f8c8d">&#34;https://github.com/makepad/makepad&#34;</span>, <span style="color:#728e00">package</span> = <span style="color:#7f8c8d">&#34;makepad-draw&#34;</span> }
</span></span><span style="display:flex;"><span><span style="color:#728e00">makepad-audio-graph</span> = { <span style="color:#728e00">git</span> = <span style="color:#7f8c8d">&#34;https://github.com/makepad/makepad&#34;</span>, <span style="color:#728e00">package</span> = <span style="color:#7f8c8d">&#34;makepad-audio-graph&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># JSON + base64 for Realtime events</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">serde</span> = { <span style="color:#728e00">version</span> = <span style="color:#7f8c8d">&#34;1&#34;</span>, <span style="color:#728e00">features</span> = [<span style="color:#7f8c8d">&#34;derive&#34;</span>] }
</span></span><span style="display:flex;"><span><span style="color:#728e00">serde_json</span> = <span style="color:#7f8c8d">&#34;1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">base64</span> = <span style="color:#7f8c8d">&#34;0.22&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># sync/async and ring buffers</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">crossbeam-channel</span> = <span style="color:#7f8c8d">&#34;0.5&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">ringbuf</span> = <span style="color:#7f8c8d">&#34;0.4&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># simple resampler for 48k‚Üí24k (CoreAudio tends to run at 48k)</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">rubato</span> = <span style="color:#7f8c8d">&#34;0.15&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">anyhow</span> = <span style="color:#7f8c8d">&#34;1&#34;</span>
</span></span></code></pre></div><blockquote>
<p>If you prefer exact crate versions, pin the Makepad git rev you test with. Makepad evolves quickly; using the git dependency keeps this sample aligned with their current APIs.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#7f8c8d">//! Minimal Makepad + OpenAI Realtime audio chat on macOS.
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">//! - Push-to-talk (spacebar or UI button) streams mic to Realtime
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">//! - We commit and request a response when the user releases PTT
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">//! - We play assistant audio as it streams in `response.audio.delta`
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">makepad_widgets</span>::<span style="color:#728e00">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">makepad_draw</span>::<span style="color:#434f54">makepad_live_id</span>::<span style="color:#728e00">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">makepad_draw</span>::<span style="color:#434f54">shader</span>::<span style="color:#434f54">std</span>::<span style="color:#728e00">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">makepad_audio_graph</span>::<span style="color:#434f54">audio_stream</span>::{<span style="color:#434f54">AudioStream</span>, <span style="color:#434f54">AudioStreamCallback</span>, <span style="color:#434f54">AudioStreamMicConfig</span>, <span style="color:#434f54">AudioStreamOutConfig</span>};
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">makepad_draw</span>::<span style="color:#434f54">web_socket</span>::{<span style="color:#434f54">WebSocket</span>, <span style="color:#434f54">HttpRequest</span>}; <span style="color:#95a5a6">// WebSocket + headers
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span><span style="color:#728e00">use</span> <span style="color:#434f54">crossbeam_channel</span>::{<span style="color:#434f54">unbounded</span>, <span style="color:#434f54">Sender</span>, <span style="color:#434f54">Receiver</span>};
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">ringbuf</span>::{<span style="color:#434f54">HeapRb</span>, <span style="color:#434f54">Rb</span>};
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">anyhow</span>::<span style="color:#728e00">Result</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">serde</span>::{<span style="color:#434f54">Deserialize</span>, <span style="color:#434f54">Serialize</span>};
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">serde_json</span>::<span style="color:#434f54">json</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">base64</span>::{<span style="color:#434f54">engine</span>::<span style="color:#434f54">general_purpose</span>::<span style="color:#434f54">STANDARD</span> <span style="color:#728e00">as</span> <span style="color:#434f54">b64</span>, <span style="color:#434f54">Engine</span> <span style="color:#728e00">as</span> <span style="color:#434f54">_</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// OpenAI Realtime endpoint + model (update if a newer preview exists)
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span><span style="color:#728e00">const</span> <span style="color:#434f54">OPENAI_REALTIME_URL</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span> <span style="color:#728e00">=</span> <span style="color:#7f8c8d">&#34;wss://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-12-17&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// PCM params for Realtime
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span><span style="color:#728e00">const</span> <span style="color:#434f54">MODEL_SR_HZ</span>: <span style="color:#00979d">usize</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">24_000</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">const</span> <span style="color:#434f54">CHANNELS</span>: <span style="color:#00979d">usize</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// How many input samples (24k) to send per append. 2400 = 100ms @ 24kHz
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span><span style="color:#728e00">const</span> <span style="color:#434f54">CHUNK_SAMPLES_24K</span>: <span style="color:#00979d">usize</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">2400</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// Simple app model
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span><span style="color:#434f54">live_design!</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">import</span> <span style="color:#434f54">makepad_widgets</span>::<span style="color:#728e00">*</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">AppUI</span> <span style="color:#728e00">=</span> <span style="color:#728e00">&lt;</span><span style="color:#434f54">Window</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">window</span>: { <span style="color:#434f54">title</span>: <span style="color:#7f8c8d">&#34;OpenAI Realtime + Makepad (macOS)&#34;</span>; },
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">&lt;</span><span style="color:#434f54">ScrollYView</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">&lt;</span><span style="color:#434f54">View</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">flow</span>: <span style="color:#434f54">Down</span>, <span style="color:#434f54">spacing</span>: <span style="color:#8a7b52">8.</span>, <span style="color:#434f54">padding</span>: <span style="color:#8a7b52">12.</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">&lt;</span><span style="color:#434f54">Label</span><span style="color:#728e00">&gt;</span> { <span style="color:#434f54">text</span>: <span style="color:#7f8c8d">&#34;Realtime Voice (Push and hold to talk)&#34;</span> }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">&lt;</span><span style="color:#434f54">Button</span> <span style="color:#434f54">id</span><span style="color:#728e00">=</span><span style="color:#434f54">ptt_btn</span><span style="color:#728e00">&gt;</span> { <span style="color:#434f54">text</span>: <span style="color:#7f8c8d">&#34;üéôÔ∏è  Hold to Talk (Space)&#34;</span> }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">&lt;</span><span style="color:#434f54">Label</span> <span style="color:#434f54">id</span><span style="color:#728e00">=</span><span style="color:#434f54">vu_label</span><span style="color:#728e00">&gt;</span> { <span style="color:#434f54">text</span>: <span style="color:#7f8c8d">&#34;Mic level: 0.00&#34;</span> }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">&lt;</span><span style="color:#434f54">Label</span> <span style="color:#434f54">id</span><span style="color:#728e00">=</span><span style="color:#434f54">conn_label</span><span style="color:#728e00">&gt;</span> { <span style="color:#434f54">text</span>: <span style="color:#7f8c8d">&#34;WebSocket: (disconnected)&#34;</span> }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">&lt;</span><span style="color:#434f54">Label</span> <span style="color:#434f54">id</span><span style="color:#728e00">=</span><span style="color:#434f54">log_label</span><span style="color:#728e00">&gt;</span> { <span style="color:#434f54">text</span>: <span style="color:#7f8c8d">&#34;‚Äî&#34;</span> }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Clone)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">struct</span> <span style="color:#434f54">Streams</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#7f8c8d">/// ring buffer for mic ‚Üí network (Int16 @ 24k)
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span>    <span style="color:#434f54">mic_24k_tx</span>: <span style="color:#434f54">Sender</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#7f8c8d">/// ring buffer for network ‚Üí speaker (Int16 @ 24k)
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span>    <span style="color:#434f54">net_24k_rx</span>: <span style="color:#434f54">Receiver</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// Audio callback implementation:
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// - pulls from net_24k_rx to play assistant audio
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">/// - captures mic from audio interface (likely 48k), downsamples to 24k, and pushes to mic_24k_tx when PTT is held
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d"></span><span style="color:#728e00">struct</span> <span style="color:#434f54">IOCallback</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">mic_to_net</span>: <span style="color:#434f54">Sender</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">net_to_speaker</span>: <span style="color:#434f54">Receiver</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// resampler 48k ‚Üí 24k
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">resampler</span>: <span style="color:#434f54">rubato</span>::<span style="color:#434f54">FftFixedInOut</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">f32</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// PTT flag updated from UI
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">ptt_active</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">Arc</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">atomic</span>::<span style="color:#434f54">AtomicBool</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// quick peak detector for VU
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">vu_tx</span>: <span style="color:#434f54">Sender</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">f32</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">AudioStreamCallback</span> <span style="color:#728e00">for</span> <span style="color:#434f54">IOCallback</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">process</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">io</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">makepad_audio_graph</span>::<span style="color:#434f54">audio_stream</span>::<span style="color:#434f54">AudioStreamIO</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Input is typically f32 @ 48000, mono
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">in_sr</span> <span style="color:#728e00">=</span> <span style="color:#434f54">io</span>.<span style="color:#434f54">sample_rate</span> <span style="color:#728e00">as</span> <span style="color:#00979d">usize</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">out_sr</span> <span style="color:#728e00">=</span> <span style="color:#434f54">MODEL_SR_HZ</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Grab mic buffer
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">mic_in</span> <span style="color:#728e00">=</span> <span style="color:#434f54">io</span>.<span style="color:#434f54">input_buffer</span>; <span style="color:#95a5a6">// f32 mono
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">frames</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mic_in</span>.<span style="color:#434f54">len</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Very small VU metering
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">peak</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mic_in</span>.<span style="color:#434f54">iter</span>().<span style="color:#434f54">fold</span>(<span style="color:#8a7b52">0.0</span><span style="color:#728e00">f32</span>, <span style="color:#728e00">|</span><span style="color:#434f54">m</span>, <span style="color:#728e00">&amp;</span><span style="color:#434f54">s</span><span style="color:#728e00">|</span> <span style="color:#434f54">m</span>.<span style="color:#434f54">max</span>(<span style="color:#434f54">s</span>.<span style="color:#434f54">abs</span>()));
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">_</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">vu_tx</span>.<span style="color:#434f54">send</span>(<span style="color:#434f54">peak</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Downsample to 24k as needed by the model
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">if</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">ptt_active</span>.<span style="color:#434f54">load</span>(<span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">atomic</span>::<span style="color:#434f54">Ordering</span>::<span style="color:#434f54">Relaxed</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#95a5a6">// resampler takes Vec&lt;Vec&lt;f32&gt;&gt; with channels; we‚Äôre mono
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            <span style="color:#728e00">if</span> <span style="color:#434f54">in_sr</span> <span style="color:#728e00">==</span> <span style="color:#434f54">out_sr</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// Direct convert to i16
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">out_i16</span> <span style="color:#728e00">=</span> <span style="color:#728e00">Vec</span>::<span style="color:#434f54">with_capacity</span>(<span style="color:#434f54">frames</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">for</span> <span style="color:#728e00">&amp;</span><span style="color:#434f54">s</span> <span style="color:#728e00">in</span> <span style="color:#434f54">mic_in</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">v</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">s</span> <span style="color:#728e00">*</span> <span style="color:#00979d">i16</span>::<span style="color:#434f54">MAX</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>).<span style="color:#434f54">clamp</span>(<span style="color:#00979d">i16</span>::<span style="color:#434f54">MIN</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>, <span style="color:#00979d">i16</span>::<span style="color:#434f54">MAX</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>) <span style="color:#728e00">as</span> <span style="color:#00979d">i16</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">out_i16</span>.<span style="color:#434f54">push</span>(<span style="color:#434f54">v</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// Chunk to ~100ms and send
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#728e00">for</span> <span style="color:#434f54">chunk</span> <span style="color:#728e00">in</span> <span style="color:#434f54">out_i16</span>.<span style="color:#434f54">chunks</span>(<span style="color:#434f54">CHUNK_SAMPLES_24K</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">_</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">mic_to_net</span>.<span style="color:#434f54">send</span>(<span style="color:#434f54">chunk</span>.<span style="color:#434f54">to_vec</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#728e00">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// Resample from (e.g.) 48k ‚Üí 24k
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#728e00">let</span> <span style="color:#434f54">in_frames</span> <span style="color:#728e00">=</span> <span style="color:#434f54">vec!</span>[<span style="color:#434f54">mic_in</span>.<span style="color:#434f54">to_vec</span>()]; <span style="color:#95a5a6">// one channel
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#728e00">let</span> <span style="color:#434f54">out</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">resampler</span>.<span style="color:#434f54">process</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">in_frames</span>, <span style="color:#728e00">None</span>).<span style="color:#434f54">unwrap_or_default</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Some</span>(<span style="color:#434f54">ch0</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">out</span>.<span style="color:#434f54">get</span>(<span style="color:#8a7b52">0</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#95a5a6">// Convert to i16 and chunk
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                    <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">out_i16</span> <span style="color:#728e00">=</span> <span style="color:#728e00">Vec</span>::<span style="color:#434f54">with_capacity</span>(<span style="color:#434f54">ch0</span>.<span style="color:#434f54">len</span>());
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">for</span> <span style="color:#728e00">&amp;</span><span style="color:#434f54">s</span> <span style="color:#728e00">in</span> <span style="color:#434f54">ch0</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">let</span> <span style="color:#434f54">v</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">s</span> <span style="color:#728e00">*</span> <span style="color:#00979d">i16</span>::<span style="color:#434f54">MAX</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>).<span style="color:#434f54">clamp</span>(<span style="color:#00979d">i16</span>::<span style="color:#434f54">MIN</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>, <span style="color:#00979d">i16</span>::<span style="color:#434f54">MAX</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>) <span style="color:#728e00">as</span> <span style="color:#00979d">i16</span>;
</span></span><span style="display:flex;"><span>                        <span style="color:#434f54">out_i16</span>.<span style="color:#434f54">push</span>(<span style="color:#434f54">v</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">for</span> <span style="color:#434f54">chunk</span> <span style="color:#728e00">in</span> <span style="color:#434f54">out_i16</span>.<span style="color:#434f54">chunks</span>(<span style="color:#434f54">CHUNK_SAMPLES_24K</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">let</span> <span style="color:#434f54">_</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">mic_to_net</span>.<span style="color:#434f54">send</span>(<span style="color:#434f54">chunk</span>.<span style="color:#434f54">to_vec</span>());
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Playback assistant audio if any pending
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">out</span> <span style="color:#728e00">=</span> <span style="color:#434f54">io</span>.<span style="color:#434f54">output_buffer</span>; <span style="color:#95a5a6">// f32 mono
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Ok</span>(<span style="color:#728e00">mut</span> <span style="color:#434f54">pcm_24k</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">net_to_speaker</span>.<span style="color:#434f54">try_recv</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#95a5a6">// Upsample to device SR if needed (naive stretch or drop); for simplicity we do ratio-based copy
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            <span style="color:#728e00">if</span> <span style="color:#434f54">io</span>.<span style="color:#434f54">sample_rate</span> <span style="color:#728e00">as</span> <span style="color:#00979d">usize</span> <span style="color:#728e00">==</span> <span style="color:#434f54">MODEL_SR_HZ</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// same rate: write directly
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#728e00">let</span> <span style="color:#434f54">n</span> <span style="color:#728e00">=</span> <span style="color:#434f54">out</span>.<span style="color:#434f54">len</span>().<span style="color:#434f54">min</span>(<span style="color:#434f54">pcm_24k</span>.<span style="color:#434f54">len</span>());
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">for</span> <span style="color:#434f54">i</span> <span style="color:#728e00">in</span> <span style="color:#8a7b52">0</span><span style="color:#728e00">..</span><span style="color:#434f54">n</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">out</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">=</span> (<span style="color:#434f54">pcm_24k</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>) <span style="color:#728e00">/</span> (<span style="color:#00979d">i16</span>::<span style="color:#434f54">MAX</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#728e00">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// simple linear upsample to device SR (not audiophile-grade)
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#728e00">let</span> <span style="color:#434f54">target</span> <span style="color:#728e00">=</span> <span style="color:#434f54">out</span>.<span style="color:#434f54">len</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">let</span> <span style="color:#434f54">src</span> <span style="color:#728e00">=</span> <span style="color:#434f54">pcm_24k</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">for</span> <span style="color:#434f54">i</span> <span style="color:#728e00">in</span> <span style="color:#8a7b52">0</span><span style="color:#728e00">..</span><span style="color:#434f54">target</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">t</span> <span style="color:#728e00">=</span> (<span style="color:#434f54">i</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>) <span style="color:#728e00">*</span> (<span style="color:#434f54">src</span>.<span style="color:#434f54">len</span>() <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>) <span style="color:#728e00">/</span> (<span style="color:#434f54">target</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">j</span> <span style="color:#728e00">=</span> <span style="color:#434f54">t</span>.<span style="color:#434f54">floor</span>() <span style="color:#728e00">as</span> <span style="color:#00979d">usize</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">frac</span> <span style="color:#728e00">=</span> <span style="color:#434f54">t</span> <span style="color:#728e00">-</span> (<span style="color:#434f54">j</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">a</span> <span style="color:#728e00">=</span> <span style="color:#434f54">src</span>.<span style="color:#434f54">get</span>(<span style="color:#434f54">j</span>).<span style="color:#434f54">copied</span>().<span style="color:#434f54">unwrap_or</span>(<span style="color:#8a7b52">0</span>) <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">b</span> <span style="color:#728e00">=</span> <span style="color:#434f54">src</span>.<span style="color:#434f54">get</span>(<span style="color:#434f54">j</span>.<span style="color:#434f54">saturating_add</span>(<span style="color:#8a7b52">1</span>)).<span style="color:#434f54">copied</span>().<span style="color:#434f54">unwrap_or</span>(<span style="color:#8a7b52">0</span>) <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>;
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">out</span>[<span style="color:#434f54">i</span>] <span style="color:#728e00">=</span> ((<span style="color:#434f54">a</span> <span style="color:#728e00">+</span> (<span style="color:#434f54">b</span> <span style="color:#728e00">-</span> <span style="color:#434f54">a</span>) <span style="color:#728e00">*</span> <span style="color:#434f54">frac</span>) <span style="color:#728e00">/</span> (<span style="color:#00979d">i16</span>::<span style="color:#434f54">MAX</span> <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>)) <span style="color:#728e00">as</span> <span style="color:#00979d">f32</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6">// ---- OpenAI Realtime event structs (only what we need) ----
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Serialize, Deserialize, Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[serde(tag = </span><span style="color:#7f8c8d">&#34;type&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">enum</span> <span style="color:#434f54">ClientEvent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;session.update&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">SessionUpdate</span> { <span style="color:#434f54">session</span>: <span style="color:#434f54">serde_json</span>::<span style="color:#434f54">Value</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;input_audio_buffer.append&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">InputAudioAppend</span> { <span style="color:#434f54">audio</span>: <span style="color:#728e00">String</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;input_audio_buffer.commit&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">InputAudioCommit</span> {},
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;response.create&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ResponseCreate</span> { <span style="color:#434f54">response</span>: <span style="color:#728e00">Option</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">serde_json</span>::<span style="color:#434f54">Value</span><span style="color:#728e00">&gt;</span> },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Deserialize, Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[serde(tag = </span><span style="color:#7f8c8d">&#34;type&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">enum</span> <span style="color:#434f54">ServerEvent</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;session.created&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">SessionCreated</span>{ <span style="color:#728e00">..</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;response.audio.delta&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ResponseAudioDelta</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">delta</span>: <span style="color:#728e00">String</span>, <span style="color:#95a5a6">// base64 chunk
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#95a5a6">// other fields omitted
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;response.audio.done&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ResponseAudioDone</span> { <span style="color:#728e00">..</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(rename = </span><span style="color:#7f8c8d">&#34;response.text.delta&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ResponseTextDelta</span> { <span style="color:#434f54">delta</span>: <span style="color:#728e00">String</span> },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[serde(other)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">Other</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6">// ---- Main App ----
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">app_main!</span>(<span style="color:#434f54">App</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">struct</span> <span style="color:#434f54">App</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ui</span>: <span style="color:#434f54">AppUI</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ws</span>: <span style="color:#728e00">Option</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">WebSocket</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">audio</span>: <span style="color:#728e00">Option</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">AudioStream</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// inter-thread comms
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">mic_rx</span>: <span style="color:#434f54">Receiver</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">net_tx</span>: <span style="color:#434f54">Sender</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// state
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">ptt_flag</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">Arc</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">atomic</span>::<span style="color:#434f54">AtomicBool</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// logging
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">log_last</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">App</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">new</span>(<span style="color:#434f54">cx</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">Cx</span>) -&gt; <span style="color:#434f54">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">ui</span> <span style="color:#728e00">=</span> <span style="color:#434f54">AppUI</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">cx</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// channels: mic ‚Üí net, net ‚Üí speaker
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> (<span style="color:#434f54">mic_tx</span>, <span style="color:#434f54">mic_rx</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">unbounded</span>::<span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> (<span style="color:#434f54">net_tx</span>, <span style="color:#434f54">net_rx</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">unbounded</span>::<span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// set up audio I/O
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">ptt_flag</span> <span style="color:#728e00">=</span> <span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">Arc</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">atomic</span>::<span style="color:#434f54">AtomicBool</span>::<span style="color:#434f54">new</span>(<span style="color:#00979d">false</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> (<span style="color:#434f54">vu_tx</span>, <span style="color:#434f54">vu_rx</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">unbounded</span>::<span style="color:#728e00">&lt;</span><span style="color:#00979d">f32</span><span style="color:#728e00">&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">device_sr</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">48_000</span><span style="color:#728e00">usize</span>; <span style="color:#95a5a6">// most Macs default to 48k
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#95a5a6">// rubato resampler setup: in_rate=48k, out_rate=24k, latency=64
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">resampler</span> <span style="color:#728e00">=</span> <span style="color:#434f54">rubato</span>::<span style="color:#434f54">FftFixedInOut</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">device_sr</span>, <span style="color:#434f54">MODEL_SR_HZ</span>, <span style="color:#8a7b52">1</span>, <span style="color:#8a7b52">64</span>, <span style="color:#434f54">rubato</span>::<span style="color:#434f54">ResampleType</span>::<span style="color:#434f54">SincBestQuality</span>).<span style="color:#434f54">unwrap</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">cb</span> <span style="color:#728e00">=</span> <span style="color:#434f54">IOCallback</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">mic_to_net</span>: <span style="color:#434f54">mic_tx</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">net_to_speaker</span>: <span style="color:#434f54">net_rx</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">resampler</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">ptt_active</span>: <span style="color:#434f54">ptt_flag</span>.<span style="color:#434f54">clone</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">vu_tx</span>,
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">audio</span> <span style="color:#728e00">=</span> <span style="color:#434f54">AudioStream</span>::<span style="color:#434f54">open</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">AudioStreamMicConfig</span>::<span style="color:#434f54">default</span>(),   <span style="color:#95a5a6">// mic input
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            <span style="color:#434f54">AudioStreamOutConfig</span>::<span style="color:#434f54">default</span>(),   <span style="color:#95a5a6">// speaker output
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            <span style="color:#434f54">cb</span>
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">ok</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// UI polling thread for VU label
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">ui_to_update</span> <span style="color:#728e00">=</span> <span style="color:#434f54">ui</span>.<span style="color:#434f54">clone</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">std</span>::<span style="color:#434f54">thread</span>::<span style="color:#434f54">spawn</span>(<span style="color:#728e00">move</span> <span style="color:#728e00">||</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">while</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Ok</span>(<span style="color:#434f54">peak</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">vu_rx</span>.<span style="color:#434f54">recv</span>() {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">ui_to_update</span>.<span style="color:#434f54">vu_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Mic level: </span><span style="color:#7f8c8d">{:.2}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">peak</span>));
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">Self</span> { <span style="color:#434f54">ui</span>, <span style="color:#434f54">ws</span>: <span style="color:#728e00">None</span>, <span style="color:#434f54">audio</span>, <span style="color:#434f54">mic_rx</span>, <span style="color:#434f54">net_tx</span>, <span style="color:#434f54">ptt_flag</span>, <span style="color:#434f54">log_last</span>: <span style="color:#728e00">String</span>::<span style="color:#434f54">new</span>() }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">connect_ws</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">cx</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">Cx</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">if</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span>.<span style="color:#434f54">is_some</span>() { <span style="color:#728e00">return</span>; }
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Build HttpRequest with required headers
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">req</span> <span style="color:#728e00">=</span> <span style="color:#434f54">HttpRequest</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">OPENAI_REALTIME_URL</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// IMPORTANT HEADERS:
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#95a5a6">// - Authorization: Bearer &lt;OPENAI_API_KEY&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#95a5a6">// - OpenAI-Beta: realtime=v1
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Ok</span>(<span style="color:#434f54">key</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">std</span>::<span style="color:#434f54">env</span>::<span style="color:#434f54">var</span>(<span style="color:#7f8c8d">&#34;OPENAI_API_KEY&#34;</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">req</span>.<span style="color:#434f54">headers</span>.<span style="color:#434f54">insert</span>(<span style="color:#7f8c8d">&#34;Authorization&#34;</span>.<span style="color:#434f54">into</span>(), <span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Bearer </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">key</span>));
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">req</span>.<span style="color:#434f54">headers</span>.<span style="color:#434f54">insert</span>(<span style="color:#7f8c8d">&#34;OpenAI-Beta&#34;</span>.<span style="color:#434f54">into</span>(), <span style="color:#7f8c8d">&#34;realtime=v1&#34;</span>.<span style="color:#434f54">into</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#728e00">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">self</span>.<span style="color:#434f54">log</span>(<span style="color:#7f8c8d">&#34;Set OPENAI_API_KEY in env before running.&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">ws</span> <span style="color:#728e00">=</span> <span style="color:#434f54">WebSocket</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">cx</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">ws</span>.<span style="color:#434f54">open</span>(<span style="color:#434f54">req</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">conn_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#7f8c8d">&#34;WebSocket: connecting‚Ä¶&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span> <span style="color:#728e00">=</span> <span style="color:#728e00">Some</span>(<span style="color:#434f54">ws</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">send_json</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">value</span>: <span style="color:#434f54">serde_json</span>::<span style="color:#434f54">Value</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Some</span>(<span style="color:#434f54">ws</span>) <span style="color:#728e00">=</span> <span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">let</span> <span style="color:#434f54">s</span> <span style="color:#728e00">=</span> <span style="color:#434f54">serde_json</span>::<span style="color:#434f54">to_string</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">value</span>).<span style="color:#434f54">unwrap</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">ws</span>.<span style="color:#434f54">send_string</span>(<span style="color:#434f54">s</span>.<span style="color:#434f54">as_str</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">session_update</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// lock model parameters; we also pick a voice and enable server VAD
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">payload</span> <span style="color:#728e00">=</span> <span style="color:#434f54">json!</span>({
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;type&#34;</span>: <span style="color:#7f8c8d">&#34;session.update&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;session&#34;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#7f8c8d">&#34;instructions&#34;</span>: <span style="color:#7f8c8d">&#34;You are a concise, friendly voice assistant.&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#7f8c8d">&#34;voice&#34;</span>: <span style="color:#7f8c8d">&#34;alloy&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#7f8c8d">&#34;turn_detection&#34;</span>: { <span style="color:#7f8c8d">&#34;type&#34;</span>: <span style="color:#7f8c8d">&#34;server_vad&#34;</span> },
</span></span><span style="display:flex;"><span>                <span style="color:#7f8c8d">&#34;input_audio_format&#34;</span>: { <span style="color:#7f8c8d">&#34;type&#34;</span>: <span style="color:#7f8c8d">&#34;pcm16&#34;</span>, <span style="color:#7f8c8d">&#34;sample_rate_hz&#34;</span>: <span style="color:#434f54">MODEL_SR_HZ</span> },
</span></span><span style="display:flex;"><span>                <span style="color:#7f8c8d">&#34;output_audio_format&#34;</span>: { <span style="color:#7f8c8d">&#34;type&#34;</span>: <span style="color:#7f8c8d">&#34;pcm16&#34;</span>, <span style="color:#7f8c8d">&#34;sample_rate_hz&#34;</span>: <span style="color:#434f54">MODEL_SR_HZ</span> }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">send_json</span>(<span style="color:#434f54">payload</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">start_ptt</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">ptt_flag</span>.<span style="color:#434f54">store</span>(<span style="color:#00979d">true</span>, <span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">atomic</span>::<span style="color:#434f54">Ordering</span>::<span style="color:#434f54">Relaxed</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">log</span>(<span style="color:#7f8c8d">&#34;PTT: streaming mic‚Ä¶&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">stop_ptt_and_request</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">ptt_flag</span>.<span style="color:#434f54">store</span>(<span style="color:#00979d">false</span>, <span style="color:#434f54">std</span>::<span style="color:#434f54">sync</span>::<span style="color:#434f54">atomic</span>::<span style="color:#434f54">Ordering</span>::<span style="color:#434f54">Relaxed</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Tell server to commit buffered user audio, then request a response
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">send_json</span>(<span style="color:#434f54">serde_json</span>::<span style="color:#434f54">to_value</span>(<span style="color:#434f54">ClientEvent</span>::<span style="color:#434f54">InputAudioCommit</span> {}).<span style="color:#434f54">unwrap</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">send_json</span>(<span style="color:#434f54">serde_json</span>::<span style="color:#434f54">to_value</span>(<span style="color:#434f54">ClientEvent</span>::<span style="color:#434f54">ResponseCreate</span> { <span style="color:#434f54">response</span>: <span style="color:#728e00">None</span> }).<span style="color:#434f54">unwrap</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">log</span>(<span style="color:#7f8c8d">&#34;PTT: committed, waiting for reply‚Ä¶&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">pump_mic_to_ws</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Nonblocking drain mic chunks and append to server buffer
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">while</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Ok</span>(<span style="color:#434f54">chunk_i16</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">mic_rx</span>.<span style="color:#434f54">try_recv</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">let</span> <span style="color:#434f54">audio_b64</span> <span style="color:#728e00">=</span> <span style="color:#434f54">b64</span>.<span style="color:#434f54">encode</span>(<span style="color:#434f54">bytemuck</span>::<span style="color:#434f54">cast_slice</span>::<span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span>, <span style="color:#00979d">u8</span><span style="color:#728e00">&gt;</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">chunk_i16</span>));
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">let</span> <span style="color:#434f54">evt</span> <span style="color:#728e00">=</span> <span style="color:#434f54">ClientEvent</span>::<span style="color:#434f54">InputAudioAppend</span> { <span style="color:#434f54">audio</span>: <span style="color:#434f54">audio_b64</span> };
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">self</span>.<span style="color:#434f54">send_json</span>(<span style="color:#434f54">serde_json</span>::<span style="color:#434f54">to_value</span>(<span style="color:#434f54">evt</span>).<span style="color:#434f54">unwrap</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">handle_ws_message</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">data</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Ok</span>(<span style="color:#434f54">evt</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">serde_json</span>::<span style="color:#434f54">from_str</span>::<span style="color:#728e00">&lt;</span><span style="color:#434f54">ServerEvent</span><span style="color:#728e00">&gt;</span>(<span style="color:#434f54">data</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">match</span> <span style="color:#434f54">evt</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">ServerEvent</span>::<span style="color:#434f54">SessionCreated</span>{<span style="color:#728e00">..</span>} <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">conn_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#7f8c8d">&#34;WebSocket: connected&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">self</span>.<span style="color:#434f54">log</span>(<span style="color:#7f8c8d">&#34;session.created&#34;</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">self</span>.<span style="color:#434f54">session_update</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">ServerEvent</span>::<span style="color:#434f54">ResponseAudioDelta</span> { <span style="color:#434f54">delta</span> } <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#95a5a6">// base64 ‚Üí Vec&lt;i16&gt; and push to speaker queue
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                    <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Ok</span>(<span style="color:#434f54">bytes</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">b64</span>.<span style="color:#434f54">decode</span>(<span style="color:#434f54">delta</span>.<span style="color:#434f54">as_bytes</span>()) {
</span></span><span style="display:flex;"><span>                        <span style="color:#95a5a6">// bytes are little-endian PCM16
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                        <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">pcm</span> <span style="color:#728e00">=</span> <span style="color:#728e00">Vec</span>::<span style="color:#728e00">&lt;</span><span style="color:#00979d">i16</span><span style="color:#728e00">&gt;</span>::<span style="color:#434f54">with_capacity</span>(<span style="color:#434f54">bytes</span>.<span style="color:#434f54">len</span>()<span style="color:#728e00">/</span><span style="color:#8a7b52">2</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">for</span> <span style="color:#434f54">b</span> <span style="color:#728e00">in</span> <span style="color:#434f54">bytes</span>.<span style="color:#434f54">chunks_exact</span>(<span style="color:#8a7b52">2</span>) {
</span></span><span style="display:flex;"><span>                            <span style="color:#728e00">let</span> <span style="color:#434f54">v</span> <span style="color:#728e00">=</span> <span style="color:#00979d">i16</span>::<span style="color:#434f54">from_le_bytes</span>([<span style="color:#434f54">b</span>[<span style="color:#8a7b52">0</span>], <span style="color:#434f54">b</span>[<span style="color:#8a7b52">1</span>]]);
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">pcm</span>.<span style="color:#434f54">push</span>(<span style="color:#434f54">v</span>);
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">let</span> <span style="color:#434f54">_</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">net_tx</span>.<span style="color:#434f54">send</span>(<span style="color:#434f54">pcm</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">ServerEvent</span>::<span style="color:#434f54">ResponseAudioDone</span> { <span style="color:#728e00">..</span> } <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">self</span>.<span style="color:#434f54">log</span>(<span style="color:#7f8c8d">&#34;response.audio.done&#34;</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">ServerEvent</span>::<span style="color:#434f54">ResponseTextDelta</span> { <span style="color:#434f54">delta</span> } <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#95a5a6">// optional: show live transcript
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                    <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">log_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Assistant (text): </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">delta</span>));
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">ServerEvent</span>::<span style="color:#434f54">Other</span> <span style="color:#728e00">=&gt;</span> {}
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">log</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">s</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">if</span> <span style="color:#434f54">s</span> <span style="color:#728e00">!=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">log_last</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">self</span>.<span style="color:#434f54">log_last</span> <span style="color:#728e00">=</span> <span style="color:#434f54">s</span>.<span style="color:#434f54">to_string</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">log_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#434f54">s</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">AppMain</span> <span style="color:#728e00">for</span> <span style="color:#434f54">App</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">handle_event</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">cx</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">Cx</span>, <span style="color:#434f54">event</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">Event</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// keep moving mic ‚Üí ws while app runs
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">pump_mic_to_ws</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">match</span> <span style="color:#434f54">event</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">Construct</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">self</span>.<span style="color:#434f54">connect_ws</span>(<span style="color:#434f54">cx</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">KeyDown</span>(<span style="color:#434f54">ke</span>) <span style="color:#728e00">if</span> <span style="color:#434f54">ke</span>.<span style="color:#434f54">key_code</span> <span style="color:#728e00">==</span> <span style="color:#434f54">KeyCode</span>::<span style="color:#434f54">Space</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">self</span>.<span style="color:#434f54">start_ptt</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">KeyUp</span>(<span style="color:#434f54">ke</span>) <span style="color:#728e00">if</span> <span style="color:#434f54">ke</span>.<span style="color:#434f54">key_code</span> <span style="color:#728e00">==</span> <span style="color:#434f54">KeyCode</span>::<span style="color:#434f54">Space</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">self</span>.<span style="color:#434f54">stop_ptt_and_request</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">PointerDown</span>(<span style="color:#434f54">pe</span>) <span style="color:#728e00">if</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">ptt_btn</span>.<span style="color:#434f54">area</span>().<span style="color:#434f54">contains</span>(<span style="color:#434f54">pe</span>.<span style="color:#434f54">abs</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">self</span>.<span style="color:#434f54">start_ptt</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">PointerUp</span>(<span style="color:#434f54">pe</span>) <span style="color:#728e00">if</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">ptt_btn</span>.<span style="color:#434f54">area</span>().<span style="color:#434f54">contains</span>(<span style="color:#434f54">pe</span>.<span style="color:#434f54">abs</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">self</span>.<span style="color:#434f54">stop_ptt_and_request</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">WebSocketMessage</span>(<span style="color:#434f54">msg</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Some</span>(<span style="color:#434f54">ws</span>) <span style="color:#728e00">=</span> <span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">if</span> <span style="color:#434f54">msg</span>.<span style="color:#434f54">websocket_uid</span> <span style="color:#728e00">==</span> <span style="color:#434f54">ws</span>.<span style="color:#434f54">websocket_uid</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">match</span> <span style="color:#434f54">msg</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">makepad_draw</span>::<span style="color:#434f54">web_socket</span>::<span style="color:#434f54">WebSocketMessage</span>::<span style="color:#728e00">String</span>{<span style="color:#434f54">data</span>, <span style="color:#728e00">..</span>} <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                                <span style="color:#434f54">self</span>.<span style="color:#434f54">handle_ws_message</span>(<span style="color:#434f54">data</span>);
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">_</span> <span style="color:#728e00">=&gt;</span> {}
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">WebSocketConnected</span>(<span style="color:#434f54">wc</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Some</span>(<span style="color:#434f54">ws</span>) <span style="color:#728e00">=</span> <span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">if</span> <span style="color:#434f54">wc</span>.<span style="color:#434f54">websocket_uid</span> <span style="color:#728e00">==</span> <span style="color:#434f54">ws</span>.<span style="color:#434f54">websocket_uid</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">conn_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#7f8c8d">&#34;WebSocket: connected&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#434f54">self</span>.<span style="color:#434f54">session_update</span>();
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">Event</span>::<span style="color:#434f54">WebSocketClosed</span>(<span style="color:#434f54">wc</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Some</span>(<span style="color:#434f54">ws</span>) <span style="color:#728e00">=</span> <span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">if</span> <span style="color:#434f54">wc</span>.<span style="color:#434f54">websocket_uid</span> <span style="color:#728e00">==</span> <span style="color:#434f54">ws</span>.<span style="color:#434f54">websocket_uid</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">conn_label</span>.<span style="color:#434f54">set_text</span>(<span style="color:#7f8c8d">&#34;WebSocket: closed&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#434f54">self</span>.<span style="color:#434f54">ws</span> <span style="color:#728e00">=</span> <span style="color:#728e00">None</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">_</span> <span style="color:#728e00">=&gt;</span> {}
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">ui</span>.<span style="color:#434f54">handle_event</span>(<span style="color:#434f54">cx</span>, <span style="color:#434f54">event</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Below is a complete, single-crate Rust example that:</p>
<ul>
<li>uses Makepad for the GUI (a minimal window with a Push-to-Talk button and a VU meter),</li>
<li>captures microphone audio via Makepad‚Äôs audio APIs,</li>
<li>opens a WebSocket (Makepad‚Äôs WebSocket) directly to OpenAI Realtime,</li>
<li>streams mic audio in PCM16 @ 24 kHz to the model,</li>
<li>receives response.audio.delta chunks and plays them out via the Makepad audio output,</li>
<li>runs fine on macOS (Apple Silicon) with the normal Rust toolchain.</li>
</ul>
<p>Heads-up: the OpenAI Realtime WebSocket requires the Authorization: Bearer header and the OpenAI-Beta: realtime=v1 header, with a URL like
wss://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2024-12-17. Audio is exchanged as base64 chunks in input_audio_buffer.append (client) and response.audio.delta (server) events; you start a reply with response.create.</p>
<p>Cloudflare Docs
OpenAI Platform
Microsoft Learn</p>
<p>The default realtime audio format is PCM16, mono, 24 kHz; we‚Äôll explicitly set both input and output to that in a session.update right after connecting.
GitHub</p>
<hr>
<p>How it works (quick tour)</p>
<p>Connect: on startup, we open a Makepad WebSocket with headers:</p>
<p>Authorization: Bearer &lt;OPENAI_API_KEY&gt;</p>
<p>OpenAI-Beta: realtime=v1
Then we send a session.update to set voice, server VAD, and PCM16/24k I/O.
Cloudflare Docs</p>
<p>Push-to-talk: while pressed, mic frames are resampled to 24 kHz, encoded base64, and dispatched in small chunks as input_audio_buffer.append. When released, we send input_audio_buffer.commit and response.create.
Microsoft Learn</p>
<p>Playback: the app listens for response.audio.delta (base64 PCM16 chunks), decodes to i16, and feeds them to the audio output callback for immediate playback; when the model finishes the turn, we see response.audio.done</p>
<hr>
<p>Build &amp; run on macOS (Apple Silicon)</p>
<p>Install Rust and Makepad prerequisites (Xcode command line tools, etc.).</p>
<p>Set your key in the environment:
export OPENAI_API_KEY=&ldquo;sk-&hellip;&rdquo;</p>
<p>Build &amp; run:
cargo run</p>
<p>Give the app microphone permission on first run (System Settings ‚Üí Privacy &amp; Security ‚Üí Microphone).</p>
<p>If you see no audio, confirm your Mac input device sample rate (Audio MIDI Setup). The sample runs a robust sinc resampler from 48 kHz ‚Üí 24 kHz.</p>
<hr>
<h3 id="notes--tweaks">Notes &amp; tweaks</h3>
<ul>
<li>
<p>Model/version: this sample targets gpt-4o-realtime-preview-2024-12-17 in the query string; swap in the latest preview when available.
Cloudflare Docs
Microsoft Learn</p>
</li>
<li>
<p>Latency vs. chunk size: we send ~100 ms chunks (2 400 samples). You can reduce CHUNK_SAMPLES_24K for snappier VAD at the cost of overhead.
Microsoft Learn</p>
</li>
<li>
<p>Text transcript: enable input_audio_transcription in session.update if you want live user-speech transcripts; listen for response.text.delta and response.audio_transcript.* events to display assistant speech text.
Microsoft Learn</p>
</li>
<li>
<p>Security: never hardcode your API key; keep it in env vars or a secure Mac keychain item.</p>
</li>
<li>
<p>WebRTC: for sub-200 ms glass-to-glass latency, prefer WebRTC; for a Makepad desktop app, WebSocket is simpler and works well.
Microsoft Learn</p>
</li>
</ul>
<h3 id="if-you-want-i-can-also-add">If you want, I can also add:</h3>
<ul>
<li>a waveform/oscilloscope widget,</li>
<li>a toggle to disable server VAD and manually control commit timing,</li>
<li>a small text chat panel that shows the full conversation items as they come in.</li>
</ul>
<h3 id="references--specs-used">References / specs used</h3>
<ul>
<li>
<p>Required headers &amp; model string for Realtime WS: Authorization + OpenAI-Beta: realtime=v1; sample URL with model=gpt-4o-realtime-preview-2024-12-17.
Cloudflare Docs</p>
</li>
<li>
<p>Client events &amp; flow: session.update, input_audio_buffer.append/commit, response.create.
Microsoft Learn
OpenAI Platform</p>
</li>
<li>
<p>Server events for audio/text streaming: response.audio.delta, response.audio.done, response.text.delta.
Microsoft Learn</p>
</li>
<li>
<p>Reference client clarifying PCM16 @ 24 kHz and the audio streaming pattern.
GitHub</p>
</li>
</ul>
<p>Happy hacking‚Äîhave fun talking to your Rust+Makepad AI!</p>
<hr>
<p>Usually we don&rsquo;t share much here from Moly, but wanted to show off that we started working on integrating realtime AI services, here&rsquo;s a mini demo of using OpenAI realtime for conversational audio
using Makepad audio APIs and Makepad websockets as well. This will work in Moly app across all platforms</p>
<h2 id="we-also-plan-on-supporting-other-providers-including-an-in-the-works-open-source-server-and-model-that-can-run-entirely-locally-something-that-can-run-on-a-m2-mac-mini-or-similar-which-im-very-hyped-about">We also plan on supporting other providers, including an (in the works) open source server and model that can run entirely locally (something that can run on a m2, mac mini or similar), which I&rsquo;m very hyped about</h2>
<!-- ////////////////////////////////////////////////////////////////////////-->
<p><img src="https://img.shields.io/badge/Work_In_Progress-orange.svg" alt="Version:0.1.0">
<img src="https://img.shields.io/badge/Text_Version-0.4.5-blue.svg" alt="Version:0.1.0">
<img src="https://img.shields.io/badge/Source_Code_Builds-Yes-green.svg" alt="Version:0.1.0"></p>
<!--![Version:0.1.0](https://img.shields.io/badge/Version-0.5.0-white.svg)  -->
<!--[![Version:0.1.0](https://img.shields.io/badge/File-issue-orange.svg)](https://github.com/cryptopatrick/learn_wgpu/issues)-->
<!-- ////////////////////////////////////////////////////////////////////////-->
<br>
<blockquote>
<p><strong>Preface:</strong> In this post we won&rsquo;t be doing much, just intstall Rust and get setup with an editor.</p>
</blockquote>
<blockquote>
<p><strong>Code:</strong> The complete source code is available on my <a href="https://github.com/cryptopatrick/timed_release_crypto">GitHub</a>.</p>
</blockquote>
<!-- ////////////////////////////////////////////////////////////////////////-->
<h2 id="to-send-a-message-into-the-future">To send a message into the future</h2>
<p><figure><img src="../../../../../img/time-lock-message/rebellion.jpg">
</figure>
<br>
<strong>‚ñ≤<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></strong> A Rebel ship orbiting above the Federation&rsquo;s top secret military research lab, <em>The Periphery</em>.</p>
<p>‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä This is a paragraph.
‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä This is another paragraph.</p>
<p><strong>The Future</strong></p>
<p>If we&rsquo;re trying to send a message into the future, then we need to spend some</p>
<!-- ////////////////////////////////////////////////////////////////////////-->
<h3 id="title">Title</h3>
<p><strong>List of topics to cover (briefly):</strong> <br>
[ ] Carmicheal Numbers and the need for primality testing of huge numbers<br>
[x] Probabilitic Primality Testing with Rabin-Miller</p>
<table>
  <thead>
      <tr>
          <th style="text-align: center">Step</th>
          <th style="text-align: left">Process</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center"><a href="#step-0-preparing-the-payload">0.</a></td>
          <td style="text-align: left">Gather message data, calculate time-lock duration, estimate attacker&rsquo;s squaring power</td>
      </tr>
      <tr>
          <td style="text-align: center"><a href="#step-1-compute-the-composite-modulus">1.</a></td>
          <td style="text-align: left">Choose two secret primes, $p$ and $q$, and compute the composite modulus: $n=p \cdot q$</td>
      </tr>
  </tbody>
</table>
<p><strong>‚ñ≤</strong> The seven steps of creating a Time-Lock Puzzle.</p>
<hr>
<h1 id="-implementation">ü¶Ä Implementation</h1>
<!-- ////////////////////////////////////////////////////////////////////////-->
<h4 id="step-0-preparing-the-payload">Step 0: Preparing the Payload</h4>
<p>$M$: <strong>Message to Protect</strong><br>
Dr. Angela Rae, and her team of fellow researchers, have quickly collected all</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Ai-generated image of Rebel spaceship.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>




    </div>
    
    
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>'I write to understand as much as to be understood.' ‚ÄîElie Wiesel<br> (c) 2024 CryptoPatrick</p>
  </div>
</section>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




</body>
