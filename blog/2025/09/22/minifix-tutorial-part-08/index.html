<!DOCTYPE html>
<html lang="en-EN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="keyword 1, keyword 2, keyword 3" name="keywords">
<meta content="CryptoPatrick" name="author">
<meta property="og:title" content="ü¶Ä miniFIX Tutorial | Part 08 - Seamless Global Nature">
<meta property="og:url" content="https://www.cryptopatrick.com/blog/2025/09/22/minifix-tutorial-part-08/">
<meta property="og:description" content="">
<meta property="og:type" content="website" />



<title>ü¶Ä miniFIX Tutorial | Part 08 | Seamless Global Nature</title>

<link rel="stylesheet" href="https://www.cryptopatrick.com//css/style.css">
<link rel="stylesheet" href="https://www.cryptopatrick.com//css/customcode.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">

 <img src="../../../../../profile.jpg" alt="Avatar" style="margin-right: 1em" height="100px">
      <div class="nav-left" style="flex-basis: auto;">
        <a class="nav-item" href="https://www.cryptopatrick.com/"><h1 class="title is-4">Seamless Global Nature</h1></a>
      <nav class="nav-item level is-mobile">
          
          
          <a class="level-item" href="https://www.cryptopatrick.com/about/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-male"></i>
            </span>
            
            About Me
          </a>
          
          <a class="level-item" href="https://www.cryptopatrick.com/tags/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-tags"></i>
            </span>
            
            Tags
          </a>
          
          <a class="level-item" href="https://100-days-of-vibe.vercel.app" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-paper-plane"></i>
            </span>
            
            100DaysOfVibe
          </a>
          
          <a class="level-item" href="https://x.com/cryptopatrick" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-twitter"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://github.com/cryptopatrick?tab=repositories" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-github"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://www.instagram.com/cryptopatrickk/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-instagram"></i>
            </span>
            
             
          </a>
          
        </nav>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">ü¶Ä miniFIX Tutorial | Part 08</h1>
    
    
    <h2 class="subtitle is-5">
      September 22, 2025
       by CryptoPatrick
      
        
        <span class="tags-inline" style="margin-left:0.1em;">
          
            
            <a class="tag is-link is-light" href="../../../../../tags/rust/" style="margin-left:0.25em;">Rust</a>
          
            
            <a class="tag is-link is-light" href="../../../../../tags/tutorials/" style="margin-left:0.25em;">Tutorials</a>
          
        </span>
      
      
    </h2>
    <div class="content">
      <h1 id="building-secure-tls-fix-acceptors-with-minifix">Building Secure TLS FIX Acceptors with miniFIX</h1>
<h2 id="introduction">Introduction</h2>
<p>In production financial systems, security is paramount. FIX messages often contain sensitive trading information that must be protected during transmission. TLS (Transport Layer Security) provides the cryptographic foundation for secure FIX communication. This post explores building a TLS-enabled FIX acceptor using miniFIX, focusing on security best practices for financial applications.</p>
<h2 id="what-youll-learn">What You&rsquo;ll Learn</h2>
<ul>
<li>Implementing TLS-secured FIX communication</li>
<li>Certificate management for financial systems</li>
<li>Building secure FIX acceptors with async Rust</li>
<li>Authentication and authorization patterns</li>
<li>Security best practices for financial messaging</li>
</ul>
<h2 id="the-security-imperative">The Security Imperative</h2>
<p>Financial messaging systems require multiple layers of security:</p>
<ul>
<li><strong>Encryption</strong>: Protect message content during transmission</li>
<li><strong>Authentication</strong>: Verify the identity of trading counterparties</li>
<li><strong>Authorization</strong>: Ensure only authorized actions are permitted</li>
<li><strong>Integrity</strong>: Detect any tampering with message content</li>
<li><strong>Non-repudiation</strong>: Maintain audit trails for regulatory compliance</li>
</ul>
<p>TLS provides the foundation for encryption, authentication, and integrity.</p>
<h2 id="tls-fix-acceptor-architecture">TLS FIX Acceptor Architecture</h2>
<p>A secure FIX acceptor typically includes:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpListener</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">tokio_native_tls</span>::{<span style="color:#434f54">TlsAcceptor</span>, <span style="color:#434f54">native_tls</span>};
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">minifix</span>::<span style="color:#434f54">prelude</span>::<span style="color:#728e00">*</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">minifix</span>::<span style="color:#434f54">tagvalue</span>::<span style="color:#434f54">Decoder</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">SecureFIXAcceptor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">tls_acceptor</span>: <span style="color:#434f54">TlsAcceptor</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">fix_dictionary</span>: <span style="color:#434f54">Dictionary</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">bind_address</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">client_certificates</span>: <span style="color:#434f54">ClientCertificateStore</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">ClientCertificateStore</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// Store for managing client certificates and permissions
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">authorized_clients</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">collections</span>::<span style="color:#434f54">HashMap</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">String</span>, <span style="color:#434f54">ClientInfo</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, Clone)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">ClientInfo</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">company_id</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">certificate_fingerprint</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">permissions</span>: <span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">Permission</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">session_config</span>: <span style="color:#434f54">SessionConfig</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, Clone)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">enum</span> <span style="color:#434f54">Permission</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">PlaceOrders</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">CancelOrders</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ViewMarketData</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">AdminAccess</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, Clone)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">SessionConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">heartbeat_interval</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">time</span>::<span style="color:#434f54">Duration</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">max_message_size</span>: <span style="color:#00979d">usize</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">allowed_message_types</span>: <span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">String</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="certificate-configuration">Certificate Configuration</h2>
<p>Setting up TLS certificates for financial systems:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">native_tls</span>::{<span style="color:#434f54">Identity</span>, <span style="color:#434f54">TlsAcceptor</span> <span style="color:#728e00">as</span> <span style="color:#434f54">NativeTlsAcceptor</span>};
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">std</span>::<span style="color:#434f54">fs</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">SecureFIXAcceptor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">new</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">cert_path</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">key_path</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">ca_cert_path</span>: <span style="color:#728e00">Option</span><span style="color:#728e00">&lt;&amp;</span><span style="color:#00979d">str</span><span style="color:#728e00">&gt;</span>
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">Self</span>, <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Load server certificate and private key
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">cert_data</span> <span style="color:#728e00">=</span> <span style="color:#434f54">fs</span>::<span style="color:#434f54">read</span>(<span style="color:#434f54">cert_path</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">CertificateLoad</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Failed to load cert: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">key_data</span> <span style="color:#728e00">=</span> <span style="color:#434f54">fs</span>::<span style="color:#434f54">read</span>(<span style="color:#434f54">key_path</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">CertificateLoad</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Failed to load key: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Create identity from certificate and key
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">identity</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Identity</span>::<span style="color:#434f54">from_pkcs8</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">cert_data</span>, <span style="color:#728e00">&amp;</span><span style="color:#434f54">key_data</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">CertificateLoad</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Invalid identity: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Configure TLS acceptor
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">tls_builder</span> <span style="color:#728e00">=</span> <span style="color:#434f54">NativeTlsAcceptor</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">identity</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">TlsSetup</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;TLS setup failed: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Require client certificates for mutual authentication
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">if</span> <span style="color:#434f54">ca_cert_path</span>.<span style="color:#434f54">is_some</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#95a5a6">// In production, you would configure client certificate validation
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            <span style="color:#95a5a6">// This example shows the structure but is not complete
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚ö†Ô∏è Client certificate validation not fully implemented&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">tls_acceptor</span> <span style="color:#728e00">=</span> <span style="color:#434f54">TlsAcceptor</span>::<span style="color:#434f54">from</span>(<span style="color:#434f54">tls_builder</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">Ok</span>(<span style="color:#434f54">Self</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">tls_acceptor</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">fix_dictionary</span>: <span style="color:#434f54">Dictionary</span>::<span style="color:#434f54">fix44</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">bind_address</span>: <span style="color:#7f8c8d">&#34;0.0.0.0:8443&#34;</span>.<span style="color:#434f54">to_string</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">client_certificates</span>: <span style="color:#434f54">ClientCertificateStore</span>::<span style="color:#434f54">new</span>(),
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">start</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">listener</span> <span style="color:#728e00">=</span> <span style="color:#434f54">TcpListener</span>::<span style="color:#434f54">bind</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>.<span style="color:#434f54">bind_address</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Bind failed: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üîí Secure FIX Acceptor listening on </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">self</span>.<span style="color:#434f54">bind_address</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">loop</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">match</span> <span style="color:#434f54">listener</span>.<span style="color:#434f54">accept</span>().<span style="color:#728e00">await</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">Ok</span>((<span style="color:#434f54">tcp_stream</span>, <span style="color:#434f54">peer_addr</span>)) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;ü§ù New connection from: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">peer_addr</span>);
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">tls_acceptor</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">tls_acceptor</span>.<span style="color:#434f54">clone</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">fix_dictionary</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">fix_dictionary</span>.<span style="color:#434f54">clone</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">client_store</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">client_certificates</span>.<span style="color:#434f54">clone</span>();
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">tokio</span>::<span style="color:#434f54">spawn</span>(<span style="color:#728e00">async</span> <span style="color:#728e00">move</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Err</span>(<span style="color:#434f54">e</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">Self</span>::<span style="color:#434f54">handle_secure_connection</span>(
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">tcp_stream</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">tls_acceptor</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">fix_dictionary</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">client_store</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">peer_addr</span>,
</span></span><span style="display:flex;"><span>                        ).<span style="color:#728e00">await</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">eprintln!</span>(<span style="color:#7f8c8d">&#34;‚ùå Secure connection error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>);
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    });
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">Err</span>(<span style="color:#434f54">e</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">eprintln!</span>(<span style="color:#7f8c8d">&#34;‚ö†Ô∏è Accept error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">handle_secure_connection</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tcp_stream</span>: <span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpStream</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tls_acceptor</span>: <span style="color:#434f54">TlsAcceptor</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">fix_dictionary</span>: <span style="color:#434f54">Dictionary</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">client_store</span>: <span style="color:#434f54">ClientCertificateStore</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">peer_addr</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">SocketAddr</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Perform TLS handshake
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">tls_stream</span> <span style="color:#728e00">=</span> <span style="color:#434f54">tls_acceptor</span>.<span style="color:#434f54">accept</span>(<span style="color:#434f54">tcp_stream</span>).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">TlsHandshake</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;TLS handshake failed: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚úÖ TLS handshake successful with </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">peer_addr</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Validate client certificate (if mutual TLS is configured)
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">if</span> <span style="color:#728e00">let</span> <span style="color:#728e00">Err</span>(<span style="color:#434f54">e</span>) <span style="color:#728e00">=</span> <span style="color:#434f54">Self</span>::<span style="color:#434f54">validate_client_certificate</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">tls_stream</span>, <span style="color:#728e00">&amp;</span><span style="color:#434f54">client_store</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">eprintln!</span>(<span style="color:#7f8c8d">&#34;üö´ Client certificate validation failed: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">return</span> <span style="color:#728e00">Err</span>(<span style="color:#434f54">e</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Handle FIX session over secure connection
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">Self</span>::<span style="color:#434f54">handle_fix_session</span>(<span style="color:#434f54">tls_stream</span>, <span style="color:#434f54">fix_dictionary</span>, <span style="color:#434f54">peer_addr</span>).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">validate_client_certificate</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">_tls_stream</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">tokio_native_tls</span>::<span style="color:#434f54">TlsStream</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpStream</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">_client_store</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">ClientCertificateStore</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">ClientInfo</span>, <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// In production, extract and validate client certificate
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#95a5a6">// For now, return a default client info
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚ö†Ô∏è Client certificate validation not fully implemented&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">Ok</span>(<span style="color:#434f54">ClientInfo</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">company_id</span>: <span style="color:#7f8c8d">&#34;DEFAULT_CLIENT&#34;</span>.<span style="color:#434f54">to_string</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">certificate_fingerprint</span>: <span style="color:#7f8c8d">&#34;not_implemented&#34;</span>.<span style="color:#434f54">to_string</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">permissions</span>: <span style="color:#434f54">vec</span><span style="color:#728e00">!</span>[<span style="color:#434f54">Permission</span>::<span style="color:#434f54">PlaceOrders</span>, <span style="color:#434f54">Permission</span>::<span style="color:#434f54">ViewMarketData</span>],
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">session_config</span>: <span style="color:#434f54">SessionConfig</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">heartbeat_interval</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">time</span>::<span style="color:#434f54">Duration</span>::<span style="color:#434f54">from_secs</span>(<span style="color:#8a7b52">30</span>),
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">max_message_size</span>: <span style="color:#8a7b52">4096</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">allowed_message_types</span>: <span style="color:#434f54">vec</span><span style="color:#728e00">!</span>[<span style="color:#7f8c8d">&#34;D&#34;</span>.<span style="color:#434f54">to_string</span>(), <span style="color:#7f8c8d">&#34;F&#34;</span>.<span style="color:#434f54">to_string</span>()], <span style="color:#95a5a6">// New Order, Cancel
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>            },
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">handle_fix_session</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">mut</span> <span style="color:#434f54">tls_stream</span>: <span style="color:#434f54">tokio_native_tls</span>::<span style="color:#434f54">TlsStream</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpStream</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">fix_dictionary</span>: <span style="color:#434f54">Dictionary</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">peer_addr</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">SocketAddr</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">use</span> <span style="color:#434f54">tokio</span>::<span style="color:#434f54">io</span>::{<span style="color:#434f54">AsyncReadExt</span>, <span style="color:#434f54">AsyncWriteExt</span>};
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">fix_decoder</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Decoder</span>::<span style="color:#434f54">new</span>(<span style="color:#434f54">fix_dictionary</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#728e00">mut</span> <span style="color:#434f54">buffer</span> <span style="color:#728e00">=</span> <span style="color:#434f54">vec!</span>[<span style="color:#8a7b52">0</span><span style="color:#728e00">u8</span>; <span style="color:#8a7b52">4096</span>];
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üì° Starting secure FIX session with </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">peer_addr</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">loop</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">match</span> <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">read</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">buffer</span>).<span style="color:#728e00">await</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">Ok</span>(<span style="color:#8a7b52">0</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üëã Client </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> disconnected&#34;</span>, <span style="color:#434f54">peer_addr</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">Ok</span>(<span style="color:#434f54">bytes_read</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">let</span> <span style="color:#434f54">data</span> <span style="color:#728e00">=</span> <span style="color:#728e00">&amp;</span><span style="color:#434f54">buffer</span>[<span style="color:#728e00">..</span><span style="color:#434f54">bytes_read</span>];
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#95a5a6">// Process FIX messages
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                    <span style="color:#728e00">match</span> <span style="color:#434f54">fix_decoder</span>.<span style="color:#434f54">decode</span>(<span style="color:#434f54">data</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">Ok</span>(<span style="color:#434f54">msg</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">Self</span>::<span style="color:#434f54">process_fix_message</span>(<span style="color:#434f54">msg</span>, <span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">tls_stream</span>, <span style="color:#434f54">peer_addr</span>).<span style="color:#728e00">await</span><span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                        <span style="color:#728e00">Err</span>(<span style="color:#434f54">e</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">eprintln!</span>(<span style="color:#7f8c8d">&#34;üîß FIX decode error from </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">: </span><span style="color:#7f8c8d">{:?}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">peer_addr</span>, <span style="color:#434f54">e</span>);
</span></span><span style="display:flex;"><span>                            <span style="color:#95a5a6">// Send reject message
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                            <span style="color:#728e00">let</span> <span style="color:#434f54">reject_msg</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Self</span>::<span style="color:#434f54">create_reject_message</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">{:?}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>));
</span></span><span style="display:flex;"><span>                            <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">write_all</span>(<span style="color:#434f54">reject_msg</span>.<span style="color:#434f54">as_bytes</span>()).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>                                .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Write error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">Err</span>(<span style="color:#434f54">e</span>) <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#434f54">eprintln!</span>(<span style="color:#7f8c8d">&#34;üí• Read error from </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">peer_addr</span>, <span style="color:#434f54">e</span>);
</span></span><span style="display:flex;"><span>                    <span style="color:#728e00">break</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">Ok</span>(())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">process_fix_message</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">msg</span>: <span style="color:#434f54">impl</span> <span style="color:#434f54">GetField</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">u32</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tls_stream</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">tokio_native_tls</span>::<span style="color:#434f54">TlsStream</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpStream</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">peer_addr</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">SocketAddr</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">use</span> <span style="color:#434f54">tokio</span>::<span style="color:#434f54">io</span>::<span style="color:#434f54">AsyncWriteExt</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Extract message type
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">msg_type</span> <span style="color:#728e00">=</span> <span style="color:#434f54">msg</span>.<span style="color:#434f54">get</span>(<span style="color:#434f54">fix44</span>::<span style="color:#434f54">MSG_TYPE</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map</span>(<span style="color:#728e00">|</span><span style="color:#434f54">bytes</span><span style="color:#728e00">|</span> <span style="color:#728e00">String</span>::<span style="color:#434f54">from_utf8_lossy</span>(<span style="color:#434f54">bytes</span>).<span style="color:#434f54">to_string</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">unwrap_or_else</span>(<span style="color:#728e00">|</span><span style="color:#434f54">_</span><span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;UNKNOWN&#34;</span>.<span style="color:#434f54">to_string</span>());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üì® Processing </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> message from </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">msg_type</span>, <span style="color:#434f54">peer_addr</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">match</span> <span style="color:#434f54">msg_type</span>.<span style="color:#434f54">as_str</span>() {
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;A&#34;</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// Logon message
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üîê Processing logon request&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">let</span> <span style="color:#434f54">response</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Self</span>::<span style="color:#434f54">create_logon_response</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">write_all</span>(<span style="color:#434f54">response</span>.<span style="color:#434f54">as_bytes</span>()).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>                    .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Write error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;0&#34;</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// Heartbeat
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üíì Heartbeat received&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">let</span> <span style="color:#434f54">response</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Self</span>::<span style="color:#434f54">create_heartbeat_response</span>();
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">write_all</span>(<span style="color:#434f54">response</span>.<span style="color:#434f54">as_bytes</span>()).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>                    .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Write error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;D&#34;</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// New Order Single
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üìù Processing new order&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">Self</span>::<span style="color:#434f54">process_new_order</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">msg</span>, <span style="color:#434f54">tls_stream</span>).<span style="color:#728e00">await</span><span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;F&#34;</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#95a5a6">// Order Cancel Request
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>                <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚ùå Processing cancel request&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">Self</span>::<span style="color:#434f54">process_cancel_request</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">msg</span>, <span style="color:#434f54">tls_stream</span>).<span style="color:#728e00">await</span><span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">_</span> <span style="color:#728e00">=&gt;</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚ö†Ô∏è Unhandled message type: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">msg_type</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#728e00">let</span> <span style="color:#434f54">reject</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Self</span>::<span style="color:#434f54">create_business_reject</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">msg_type</span>, <span style="color:#7f8c8d">&#34;Unsupported message type&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">write_all</span>(<span style="color:#434f54">reject</span>.<span style="color:#434f54">as_bytes</span>()).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>                    .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Write error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">Ok</span>(())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">process_new_order</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">msg</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">impl</span> <span style="color:#434f54">GetField</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">u32</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tls_stream</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">tokio_native_tls</span>::<span style="color:#434f54">TlsStream</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpStream</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">use</span> <span style="color:#434f54">tokio</span>::<span style="color:#434f54">io</span>::<span style="color:#434f54">AsyncWriteExt</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Extract order details
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">cl_ord_id</span> <span style="color:#728e00">=</span> <span style="color:#434f54">msg</span>.<span style="color:#434f54">get</span>(<span style="color:#434f54">fix44</span>::<span style="color:#434f54">CL_ORD_ID</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map</span>(<span style="color:#728e00">|</span><span style="color:#434f54">bytes</span><span style="color:#728e00">|</span> <span style="color:#728e00">String</span>::<span style="color:#434f54">from_utf8_lossy</span>(<span style="color:#434f54">bytes</span>).<span style="color:#434f54">to_string</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">unwrap_or_else</span>(<span style="color:#728e00">|</span><span style="color:#434f54">_</span><span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;UNKNOWN&#34;</span>.<span style="color:#434f54">to_string</span>());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">symbol</span> <span style="color:#728e00">=</span> <span style="color:#434f54">msg</span>.<span style="color:#434f54">get</span>(<span style="color:#434f54">fix44</span>::<span style="color:#434f54">SYMBOL</span>)
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map</span>(<span style="color:#728e00">|</span><span style="color:#434f54">bytes</span><span style="color:#728e00">|</span> <span style="color:#728e00">String</span>::<span style="color:#434f54">from_utf8_lossy</span>(<span style="color:#434f54">bytes</span>).<span style="color:#434f54">to_string</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">unwrap_or_else</span>(<span style="color:#728e00">|</span><span style="color:#434f54">_</span><span style="color:#728e00">|</span> <span style="color:#7f8c8d">&#34;UNKNOWN&#34;</span>.<span style="color:#434f54">to_string</span>());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;   Order ID: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">cl_ord_id</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;   Symbol: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">symbol</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Create execution report (simplified)
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">exec_report</span> <span style="color:#728e00">=</span> <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;8=FIX.4.4|9=150|35=8|49=SERVER|56=CLIENT|34=1|52=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|11=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|17=EXEC_001|150=0|39=0|55=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|54=1|38=100|10=123|&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">format</span>(<span style="color:#7f8c8d">&#34;%Y%m%d-%H:%M:%S%.3f&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">cl_ord_id</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">symbol</span>
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">replace</span>(<span style="color:#7f8c8d">&#39;|&#39;</span>, <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">\x01</span><span style="color:#7f8c8d">&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">write_all</span>(<span style="color:#434f54">exec_report</span>.<span style="color:#434f54">as_bytes</span>()).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Write error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚úÖ Execution report sent&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">Ok</span>(())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">process_cancel_request</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">_msg</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">impl</span> <span style="color:#434f54">GetField</span><span style="color:#728e00">&lt;</span><span style="color:#00979d">u32</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tls_stream</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">mut</span> <span style="color:#434f54">tokio_native_tls</span>::<span style="color:#434f54">TlsStream</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">tokio</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">TcpStream</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">use</span> <span style="color:#434f54">tokio</span>::<span style="color:#434f54">io</span>::<span style="color:#434f54">AsyncWriteExt</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;   Processing cancel request&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Send cancel confirmation (simplified)
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">let</span> <span style="color:#434f54">cancel_confirm</span> <span style="color:#728e00">=</span> <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;8=FIX.4.4|9=100|35=9|49=SERVER|56=CLIENT|34=2|52=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|11=CANCEL_001|41=ORIG_001|39=4|10=123|&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">format</span>(<span style="color:#7f8c8d">&#34;%Y%m%d-%H:%M:%S%.3f&#34;</span>)
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">replace</span>(<span style="color:#7f8c8d">&#39;|&#39;</span>, <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">\x01</span><span style="color:#7f8c8d">&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">tls_stream</span>.<span style="color:#434f54">write_all</span>(<span style="color:#434f54">cancel_confirm</span>.<span style="color:#434f54">as_bytes</span>()).<span style="color:#728e00">await</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">map_err</span>(<span style="color:#728e00">|</span><span style="color:#434f54">e</span><span style="color:#728e00">|</span> <span style="color:#434f54">SecurityError</span>::<span style="color:#434f54">NetworkError</span>(<span style="color:#434f54">format!</span>(<span style="color:#7f8c8d">&#34;Write error: </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>, <span style="color:#434f54">e</span>)))<span style="color:#728e00">?</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚úÖ Cancel confirmation sent&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">Ok</span>(())
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">create_logon_response</span>() -&gt; <span style="color:#728e00">String</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;8=FIX.4.4|9=60|35=A|49=SERVER|56=CLIENT|34=1|52=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|98=0|108=30|10=123|&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">format</span>(<span style="color:#7f8c8d">&#34;%Y%m%d-%H:%M:%S%.3f&#34;</span>)
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">replace</span>(<span style="color:#7f8c8d">&#39;|&#39;</span>, <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">\x01</span><span style="color:#7f8c8d">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">create_heartbeat_response</span>() -&gt; <span style="color:#728e00">String</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;8=FIX.4.4|9=50|35=0|49=SERVER|56=CLIENT|34=1|52=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|10=123|&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">format</span>(<span style="color:#7f8c8d">&#34;%Y%m%d-%H:%M:%S%.3f&#34;</span>)
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">replace</span>(<span style="color:#7f8c8d">&#39;|&#39;</span>, <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">\x01</span><span style="color:#7f8c8d">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">create_reject_message</span>(<span style="color:#434f54">reason</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>) -&gt; <span style="color:#728e00">String</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;8=FIX.4.4|9=80|35=3|49=SERVER|56=CLIENT|34=1|52=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|45=1|373=1|58=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|10=123|&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">format</span>(<span style="color:#7f8c8d">&#34;%Y%m%d-%H:%M:%S%.3f&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">reason</span>
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">replace</span>(<span style="color:#7f8c8d">&#39;|&#39;</span>, <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">\x01</span><span style="color:#7f8c8d">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">create_business_reject</span>(<span style="color:#434f54">msg_type</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>, <span style="color:#434f54">reason</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>) -&gt; <span style="color:#728e00">String</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;8=FIX.4.4|9=100|35=j|49=SERVER|56=CLIENT|34=1|52=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|45=1|372=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|380=1|58=</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">|10=123|&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">format</span>(<span style="color:#7f8c8d">&#34;%Y%m%d-%H:%M:%S%.3f&#34;</span>),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">msg_type</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">reason</span>
</span></span><span style="display:flex;"><span>        ).<span style="color:#434f54">replace</span>(<span style="color:#7f8c8d">&#39;|&#39;</span>, <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">\x01</span><span style="color:#7f8c8d">&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">ClientCertificateStore</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">new</span>() -&gt; <span style="color:#434f54">Self</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">Self</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">authorized_clients</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">collections</span>::<span style="color:#434f54">HashMap</span>::<span style="color:#434f54">new</span>(),
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">fn</span> <span style="color:#d35400">add_authorized_client</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">client_info</span>: <span style="color:#434f54">ClientInfo</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">self</span>.<span style="color:#434f54">authorized_clients</span>.<span style="color:#434f54">insert</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">client_info</span>.<span style="color:#434f54">certificate_fingerprint</span>.<span style="color:#434f54">clone</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">client_info</span>,
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, thiserror::Error)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">enum</span> <span style="color:#434f54">SecurityError</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[error(</span><span style="color:#7f8c8d">&#34;Certificate loading error: {0}&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">CertificateLoad</span>(<span style="color:#728e00">String</span>),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[error(</span><span style="color:#7f8c8d">&#34;TLS setup error: {0}&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">TlsSetup</span>(<span style="color:#728e00">String</span>),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[error(</span><span style="color:#7f8c8d">&#34;TLS handshake error: {0}&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">TlsHandshake</span>(<span style="color:#728e00">String</span>),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[error(</span><span style="color:#7f8c8d">&#34;Network error: {0}&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">NetworkError</span>(<span style="color:#728e00">String</span>),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[error(</span><span style="color:#7f8c8d">&#34;Authentication failed: {0}&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">AuthenticationFailed</span>(<span style="color:#728e00">String</span>),
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[error(</span><span style="color:#7f8c8d">&#34;Authorization failed: {0}&#34;</span><span style="color:#728e00">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">AuthorizationFailed</span>(<span style="color:#728e00">String</span>),
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="main-application">Main Application</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">#[tokio::main]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">main</span>() -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#728e00">Box</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">dyn</span> <span style="color:#434f54">std</span>::<span style="color:#434f54">error</span>::<span style="color:#434f54">Error</span><span style="color:#728e00">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üöÄ Starting Secure FIX Acceptor&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// Note: In production, use proper certificate paths
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚ö†Ô∏è This is a template implementation&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚ö†Ô∏è Use proper certificates and complete security implementation for production&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#95a5a6">// Example of how you would start the acceptor:
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">// let acceptor = SecureFIXAcceptor::new(
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">//     &#34;certs/server.crt&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">//     &#34;certs/server.key&#34;, 
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">//     Some(&#34;certs/ca.crt&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">// )?;
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">// 
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    <span style="color:#95a5a6">// acceptor.start().await?;
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;‚úÖ Template loaded successfully&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üìù TODO: Implement proper certificate management&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üìù TODO: Complete TLS configuration&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">println!</span>(<span style="color:#7f8c8d">&#34;üìù TODO: Add client authentication&#34;</span>);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">Ok</span>(())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="security-best-practices">Security Best Practices</h2>
<h3 id="certificate-management">Certificate Management</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">CertificateManager</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">cert_store</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">collections</span>::<span style="color:#434f54">HashMap</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">String</span>, <span style="color:#434f54">Certificate</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">ca_certificates</span>: <span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">Certificate</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">CertificateManager</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">load_ca_certificates</span>(<span style="color:#434f54">ca_path</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">Certificate</span><span style="color:#728e00">&gt;</span>, <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Load and validate CA certificates
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">todo!</span>(<span style="color:#7f8c8d">&#34;Implement CA certificate loading&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">validate_certificate_chain</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">cert_chain</span>: <span style="color:#00979d">&amp;</span>[<span style="color:#434f54">Certificate</span>]
</span></span><span style="display:flex;"><span>    ) -&gt; <span style="color:#728e00">Result</span><span style="color:#728e00">&lt;</span>(), <span style="color:#434f54">SecurityError</span><span style="color:#728e00">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Validate certificate chain against CA
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">todo!</span>(<span style="color:#7f8c8d">&#34;Implement certificate chain validation&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">check_certificate_expiry</span>(<span style="color:#728e00">&amp;</span><span style="color:#434f54">self</span>, <span style="color:#434f54">cert</span>: <span style="color:#00979d">&amp;</span><span style="color:#434f54">Certificate</span>) -&gt; <span style="color:#00979d">bool</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Check if certificate is still valid
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">todo!</span>(<span style="color:#7f8c8d">&#34;Implement certificate expiry check&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="audit-logging">Audit Logging</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">SecurityAuditor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">log_file</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">fs</span>::<span style="color:#434f54">File</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">SecurityAuditor</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">log_connection_attempt</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">peer_addr</span>: <span style="color:#434f54">std</span>::<span style="color:#434f54">net</span>::<span style="color:#434f54">SocketAddr</span>, <span style="color:#434f54">success</span>: <span style="color:#00979d">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">log_entry</span> <span style="color:#728e00">=</span> <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> - CONNECTION_ATTEMPT from </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> - </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">to_rfc3339</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">peer_addr</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">if</span> <span style="color:#434f54">success</span> { <span style="color:#7f8c8d">&#34;SUCCESS&#34;</span> } <span style="color:#728e00">else</span> { <span style="color:#7f8c8d">&#34;FAILED&#34;</span> }
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">writeln!</span>(<span style="color:#434f54">self</span>.<span style="color:#434f54">log_file</span>, <span style="color:#7f8c8d">&#34;{}&#34;</span>, <span style="color:#434f54">log_entry</span>).<span style="color:#434f54">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">log_message_processing</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">msg_type</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>, <span style="color:#434f54">client_id</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>, <span style="color:#434f54">success</span>: <span style="color:#00979d">bool</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">log_entry</span> <span style="color:#728e00">=</span> <span style="color:#434f54">format!</span>(
</span></span><span style="display:flex;"><span>            <span style="color:#7f8c8d">&#34;</span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> - MESSAGE_PROCESSING </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> from </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d"> - </span><span style="color:#7f8c8d">{}</span><span style="color:#7f8c8d">&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">chrono</span>::<span style="color:#434f54">Utc</span>::<span style="color:#434f54">now</span>().<span style="color:#434f54">to_rfc3339</span>(),
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">msg_type</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">client_id</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#728e00">if</span> <span style="color:#434f54">success</span> { <span style="color:#7f8c8d">&#34;SUCCESS&#34;</span> } <span style="color:#728e00">else</span> { <span style="color:#7f8c8d">&#34;FAILED&#34;</span> }
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">writeln!</span>(<span style="color:#434f54">self</span>.<span style="color:#434f54">log_file</span>, <span style="color:#7f8c8d">&#34;{}&#34;</span>, <span style="color:#434f54">log_entry</span>).<span style="color:#434f54">ok</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="rate-limiting">Rate Limiting</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">std</span>::<span style="color:#434f54">collections</span>::<span style="color:#434f54">HashMap</span>;
</span></span><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">std</span>::<span style="color:#434f54">time</span>::{<span style="color:#434f54">Duration</span>, <span style="color:#434f54">Instant</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">RateLimiter</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">client_limits</span>: <span style="color:#434f54">HashMap</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">String</span>, <span style="color:#434f54">ClientRateLimit</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">default_limit</span>: <span style="color:#434f54">RateLimit</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">struct</span> <span style="color:#434f54">ClientRateLimit</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">limit</span>: <span style="color:#434f54">RateLimit</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">requests</span>: <span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#434f54">Instant</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">struct</span> <span style="color:#434f54">RateLimit</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">max_requests</span>: <span style="color:#00979d">usize</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">window</span>: <span style="color:#434f54">Duration</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">impl</span> <span style="color:#434f54">RateLimiter</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">check_rate_limit</span>(<span style="color:#728e00">&amp;</span><span style="color:#728e00">mut</span> <span style="color:#434f54">self</span>, <span style="color:#434f54">client_id</span>: <span style="color:#00979d">&amp;</span><span style="color:#00979d">str</span>) -&gt; <span style="color:#00979d">bool</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">now</span> <span style="color:#728e00">=</span> <span style="color:#434f54">Instant</span>::<span style="color:#434f54">now</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#728e00">let</span> <span style="color:#434f54">client_limit</span> <span style="color:#728e00">=</span> <span style="color:#434f54">self</span>.<span style="color:#434f54">client_limits</span>
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">entry</span>(<span style="color:#434f54">client_id</span>.<span style="color:#434f54">to_string</span>())
</span></span><span style="display:flex;"><span>            .<span style="color:#434f54">or_insert_with</span>(<span style="color:#728e00">||</span> <span style="color:#434f54">ClientRateLimit</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">limit</span>: <span style="color:#434f54">self</span>.<span style="color:#434f54">default_limit</span>.<span style="color:#434f54">clone</span>(),
</span></span><span style="display:flex;"><span>                <span style="color:#434f54">requests</span>: <span style="color:#728e00">Vec</span>::<span style="color:#434f54">new</span>(),
</span></span><span style="display:flex;"><span>            });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Remove old requests outside the window
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">client_limit</span>.<span style="color:#434f54">requests</span>.<span style="color:#434f54">retain</span>(<span style="color:#728e00">|&amp;</span><span style="color:#434f54">time</span><span style="color:#728e00">|</span> <span style="color:#434f54">now</span>.<span style="color:#434f54">duration_since</span>(<span style="color:#434f54">time</span>) <span style="color:#728e00">&lt;</span> <span style="color:#434f54">client_limit</span>.<span style="color:#434f54">limit</span>.<span style="color:#434f54">window</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Check if under the limit
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#728e00">if</span> <span style="color:#434f54">client_limit</span>.<span style="color:#434f54">requests</span>.<span style="color:#434f54">len</span>() <span style="color:#728e00">&lt;</span> <span style="color:#434f54">client_limit</span>.<span style="color:#434f54">limit</span>.<span style="color:#434f54">max_requests</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#434f54">client_limit</span>.<span style="color:#434f54">requests</span>.<span style="color:#434f54">push</span>(<span style="color:#434f54">now</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#00979d">true</span>
</span></span><span style="display:flex;"><span>        } <span style="color:#728e00">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#00979d">false</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="production-configuration">Production Configuration</h2>
<h3 id="environment-based-configuration">Environment-Based Configuration</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">use</span> <span style="color:#434f54">serde</span>::{<span style="color:#434f54">Deserialize</span>, <span style="color:#434f54">Serialize</span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, Deserialize, Serialize)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">SecureFixConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">tls</span>: <span style="color:#434f54">TlsConfig</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">security</span>: <span style="color:#434f54">SecurityConfig</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">server</span>: <span style="color:#434f54">ServerConfig</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, Deserialize, Serialize)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">TlsConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">cert_path</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">key_path</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">ca_cert_path</span>: <span style="color:#728e00">Option</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">String</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">require_client_cert</span>: <span style="color:#00979d">bool</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">cipher_suites</span>: <span style="color:#728e00">Vec</span><span style="color:#728e00">&lt;</span><span style="color:#728e00">String</span><span style="color:#728e00">&gt;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">min_tls_version</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">#[derive(Debug, Deserialize, Serialize)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">pub</span> <span style="color:#728e00">struct</span> <span style="color:#434f54">SecurityConfig</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">max_connections_per_ip</span>: <span style="color:#00979d">usize</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">rate_limit_per_minute</span>: <span style="color:#00979d">usize</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">session_timeout_seconds</span>: <span style="color:#00979d">u64</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">pub</span> <span style="color:#434f54">audit_log_path</span>: <span style="color:#728e00">String</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="testing-tls-security">Testing TLS Security</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#728e00">#[cfg(test)]</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">mod</span> <span style="color:#434f54">tests</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">use</span> <span style="color:#728e00">super</span>::<span style="color:#728e00">*</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[tokio::test]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">test_tls_handshake</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Test TLS handshake with valid certificates
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">todo!</span>(<span style="color:#7f8c8d">&#34;Implement TLS handshake test&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[tokio::test]</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">test_invalid_certificate_rejection</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Test rejection of invalid certificates
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">todo!</span>(<span style="color:#7f8c8d">&#34;Implement certificate rejection test&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">#[tokio::test]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">async</span> <span style="color:#728e00">fn</span> <span style="color:#d35400">test_rate_limiting</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#95a5a6">// Test rate limiting functionality
</span></span></span><span style="display:flex;"><span><span style="color:#95a5a6"></span>        <span style="color:#434f54">todo!</span>(<span style="color:#7f8c8d">&#34;Implement rate limiting test&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="key-security-considerations">Key Security Considerations</h2>
<ol>
<li><strong>Certificate Management</strong>: Use proper PKI infrastructure</li>
<li><strong>Cipher Suites</strong>: Configure strong cipher suites</li>
<li><strong>Certificate Validation</strong>: Implement proper certificate chain validation</li>
<li><strong>Rate Limiting</strong>: Prevent abuse and DoS attacks</li>
<li><strong>Audit Logging</strong>: Maintain comprehensive security logs</li>
<li><strong>Session Management</strong>: Implement proper session timeouts</li>
<li><strong>Error Handling</strong>: Don&rsquo;t leak sensitive information in error messages</li>
</ol>
<p>This secure TLS FIX acceptor provides a foundation for building production-grade financial messaging systems with proper security controls. Remember that security is a complex topic that requires careful attention to detail and regular security reviews.</p>
<hr>
<h2 id="series-conclusion">Series Conclusion</h2>
<p>Congratulations on completing the miniFIX tutorial series! Throughout these 8 parts, we&rsquo;ve covered:</p>
<ol>
<li><strong>Basic FIX Decoding</strong> - Understanding FIX messages and type-safe field access</li>
<li><strong>Streaming Decoding</strong> - Handling continuous message streams efficiently</li>
<li><strong>Message Encoding</strong> - Creating type-safe FIX messages</li>
<li><strong>Custom Specifications</strong> - Extending miniFIX for exchange-specific protocols</li>
<li><strong>JSON Conversion</strong> - Integrating with modern JSON-based APIs</li>
<li><strong>Field Validation</strong> - Building robust, production-ready systems</li>
<li><strong>Production Patterns</strong> - Async networking and advanced architectures</li>
<li><strong>Testing &amp; Security</strong> - Comprehensive testing and TLS security</li>
</ol>
<p>You now have the knowledge to build production-grade FIX trading systems in Rust. The combination of miniFIX&rsquo;s type safety, Rust&rsquo;s performance, and proper testing practices enables you to create reliable, high-performance financial applications.</p>
<p><strong>Back to:</strong> <a href="../../../../../blog/2025/09/14/rust-minifix-tutorial-series/">miniFIX Tutorial Series Introduction</a></p>




    </div>
    
    
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>'I write to understand as much as to be understood.' ‚ÄîElie Wiesel<br> (c) 2024 CryptoPatrick</p>
  </div>
</section>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




</body>
