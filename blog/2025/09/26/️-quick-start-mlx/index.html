<!DOCTYPE html>
<html lang="en-EN">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=60544&amp;path=livereload" data-no-instant defer></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta content="keyword 1, keyword 2, keyword 3" name="keywords">
<meta content="CryptoPatrick" name="author">
<meta property="og:title" content="üßó‚Äç‚ôÇÔ∏è Quick Start: MLX - Seamless Global Nature">
<meta property="og:url" content="http://localhost:60544/blog/2025/09/26/%EF%B8%8F-quick-start-mlx/">
<meta property="og:description" content="">
<meta property="og:type" content="website" />


<meta property="og:image" content="http://localhost:60544/img/post-name/name.jpg" />


<title>üßó‚Äç‚ôÇÔ∏è Quick Start: MLX | Seamless Global Nature</title>

<link rel="stylesheet" href="http://localhost:60544//css/style.css">
<link rel="stylesheet" href="http://localhost:60544//css/customcode.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<link rel="stylesheet"
      href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/styles/default.min.css">

</head>

<body>
<section class="section">
  <div class="container">
    <nav class="nav">

 <img src="../../../../../profile.jpg" alt="Avatar" style="margin-right: 1em" height="100px">
      <div class="nav-left" style="flex-basis: auto;">
        <a class="nav-item" href="http://localhost:60544/"><h1 class="title is-4">Seamless Global Nature</h1></a>
      <nav class="nav-item level is-mobile">
          
          
          <a class="level-item" href="http://localhost:60544/about/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-male"></i>
            </span>
            
            About Me
          </a>
          
          <a class="level-item" href="http://localhost:60544/tags/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-tags"></i>
            </span>
            
            Tags
          </a>
          
          <a class="level-item" href="https://100-days-of-vibe.vercel.app" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-paper-plane"></i>
            </span>
            
            100DaysOfVibe
          </a>
          
          <a class="level-item" href="https://x.com/cryptopatrick" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-twitter"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://github.com/cryptopatrick?tab=repositories" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-github"></i>
            </span>
            
             
          </a>
          
          <a class="level-item" href="https://www.instagram.com/cryptopatrickk/" style="display: flex; align-items: center;">
            
            <span class="icon" style="margin-right: 0.175em; display: flex; align-items: center;">
              <i class="fa fa-instagram"></i>
            </span>
            
             
          </a>
          
        </nav>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h1 class="title">üßó‚Äç‚ôÇÔ∏è Quick Start: MLX</h1>
    
    
    <h2 class="subtitle is-5">
      September 26, 2025
       by CryptoPatrick
      
        
        <span class="tags-inline" style="margin-left:0.1em;">
          
            
            <a class="tag is-link is-light" href="../../../../../tags/ai/" style="margin-left:0.25em;">Ai</a>
          
            
            <a class="tag is-link is-light" href="../../../../../tags/quickstart/" style="margin-left:0.25em;">QuickStart</a>
          
        </span>
      
      
    </h2>
    <div class="content">
      <!-- ////////////////////////////////////////////////////////////////////////-->
<p><img src="https://img.shields.io/badge/Work_In_Progress-orange.svg" alt="Version:0.1.0">
<img src="https://img.shields.io/badge/Text_Version-0.4.5-blue.svg" alt="Version:0.1.0">
<img src="https://img.shields.io/badge/Source_Code_Builds-Yes-green.svg" alt="Version:0.1.0"></p>
<!--![Version:0.1.0](https://img.shields.io/badge/Version-0.5.0-white.svg)  -->
<!--[![Version:0.1.0](https://img.shields.io/badge/File-issue-orange.svg)](https://github.com/cryptopatrick/learn_wgpu/issues)-->
<!-- ////////////////////////////////////////////////////////////////////////-->
<br>
MLX core API closely follows NumPy and can work as a drop-in replacement of this famous library.
The functionality of MLX is similar to that found in PyTorch and JAX.
MLX language front-ends include: Python, Swift, C++, and C.
While many HPC architectures separate GPU from CPU memory, MLX uses a Unified memory
for both GPU and CPU operations.
<blockquote>
<p>github.com/ml-explore
hugginface</p>
</blockquote>
<blockquote>
<p>LM Studio uses MLX.</p>
</blockquote>
<hr>
<h1 id="getting-started">Getting Started</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#95a5a6"># Installation.</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">pip3</span> <span style="color:#434f54">install</span> <span style="color:#434f54">mlx</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Start doing compuation on arrays.</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">mlx.core</span> <span style="color:#728e00">as</span> <span style="color:#434f54">mx</span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Make two arrays.</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">a</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">array</span>([<span style="color:#8a7b52">1</span>,<span style="color:#8a7b52">2</span>,<span style="color:#8a7b52">3</span>])
</span></span><span style="display:flex;"><span><span style="color:#434f54">b</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">array</span>([<span style="color:#8a7b52">4</span>,<span style="color:#8a7b52">5</span>,<span style="color:#8a7b52">6</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># MLX uses Lazy Evaluation, so the addition will not happen until it needs to.</span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Perform an operation.</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">c</span> <span style="color:#728e00">=</span> <span style="color:#434f54">a</span> <span style="color:#728e00">+</span> <span style="color:#434f54">b</span> <span style="color:#95a5a6"># not computed.</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#434f54">c</span>)  <span style="color:#95a5a6"># computed.</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">eval</span>(<span style="color:#434f54">c</span>) <span style="color:#95a5a6"># force computation.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Access information about the array.</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">shape</span> <span style="color:#728e00">=</span> <span style="color:#434f54">c</span><span style="color:#728e00">.</span><span style="color:#434f54">shape</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">dtype</span> <span style="color:#728e00">=</span> <span style="color:#434f54">c</span><span style="color:#728e00">.</span><span style="color:#434f54">dtype</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Run an operation on a specific device (CPU or GPU).</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">c</span> <span style="color:#728e00">=</span> <span style="color:#434f54">md</span><span style="color:#728e00">.</span><span style="color:#434f54">add</span>(<span style="color:#434f54">a</span>,<span style="color:#434f54">b</span>, <span style="color:#434f54">stream</span><span style="color:#728e00">=</span><span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">gpu</span>)
</span></span><span style="display:flex;"><span><span style="color:#434f54">d</span> <span style="color:#728e00">=</span> <span style="color:#434f54">md</span><span style="color:#728e00">.</span><span style="color:#434f54">multiply</span>(<span style="color:#434f54">a</span>,<span style="color:#434f54">b</span>, <span style="color:#434f54">stream</span><span style="color:#728e00">=</span><span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">cpu</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Function Transformations: auto differentiation and graph optomization.</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">def</span> <span style="color:#d35400">sin</span>(<span style="color:#434f54">x</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">return</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">sin</span>(<span style="color:#434f54">x</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">dfdx</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">grad</span>(<span style="color:#434f54">sin</span>)
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Compute the derivative of sine at 1.0. </span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">dfdx</span>(<span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">array</span>(<span style="color:#8a7b52">1.0</span>))
</span></span></code></pre></div><h2 id="neural-networks-in-mlx">Neural Networks in MLX</h2>
<p>Two packages that are useful for dealing with neural networks.
The primary module is <code>nn.Module</code>, which all layers and containers use.
mlx.nn
mlx.optimizers</p>
<h3 id="lets-build-a-multi-layer-neural-network">Let&rsquo;s build a Multi-Layer Neural Network</h3>
<pre tabindex="0"><code class="language-class" data-lang="class">  &#34;&#34;&#34;A simple MLP.&#34;&#34;&#34;

    def __init__(self, dim, h_dim):
      super().__init__()
      self.linear1 = nn.Linear(dim, h_dim)
      self.linear2 = nn.Linear(h_dim, dim)

    def __call__(self, x):
      x = self.linear1(x)
      x = nn.relu(x)
      x = self.linear2(x)
      return x
</code></pre><h3 id="compiling-mlx-functions">Compiling MLX functions</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">mlx.core</span> <span style="color:#728e00">as</span> <span style="color:#434f54">mx</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">math</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#7f8c8d">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Each of these computations corresponds to 
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">a separate CPU kernel launch under the hood:
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Divide
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Erf
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Add
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Multiply
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Divide
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">---
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Compiling the  computation graph results into a single fused kernel.
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">Compiled gelu
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">def</span> <span style="color:#d35400">gelu</span>(<span style="color:#434f54">x</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">return</span> <span style="color:#434f54">x</span> <span style="color:#728e00">*</span> (<span style="color:#8a7b52">1</span> <span style="color:#728e00">+</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">erf</span>(<span style="color:#434f54">x</span> <span style="color:#728e00">/</span> <span style="color:#434f54">math</span><span style="color:#728e00">.</span><span style="color:#434f54">sqrt</span>(<span style="color:#8a7b52">2</span>))) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">@mx.compile</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">def</span> <span style="color:#d35400">compiled_gelu</span>(<span style="color:#434f54">x</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">return</span> <span style="color:#434f54">x</span> <span style="color:#728e00">*</span> (<span style="color:#8a7b52">1</span> <span style="color:#728e00">+</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">erf</span>(<span style="color:#434f54">x</span> <span style="color:#728e00">/</span> <span style="color:#434f54">math</span><span style="color:#728e00">.</span><span style="color:#434f54">sqrt</span>(<span style="color:#8a7b52">2</span>))) <span style="color:#728e00">/</span> <span style="color:#8a7b52">2</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">x</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">random</span><span style="color:#728e00">.</span><span style="color:#434f54">normal</span>(<span style="color:#434f54">shape</span><span style="color:#728e00">=</span>(<span style="color:#8a7b52">4</span>,))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">out</span> <span style="color:#728e00">=</span> <span style="color:#434f54">gelu</span>(<span style="color:#434f54">x</span>)
</span></span><span style="display:flex;"><span><span style="color:#434f54">compiled_out</span> <span style="color:#728e00">=</span> <span style="color:#434f54">compiled_gelu</span>(<span style="color:#434f54">x</span>)
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#7f8c8d">f</span><span style="color:#7f8c8d">&#34;gelu:          </span><span style="color:#7f8c8d">{</span><span style="color:#434f54">out</span><span style="color:#7f8c8d">}</span><span style="color:#7f8c8d">&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#7f8c8d">f</span><span style="color:#7f8c8d">&#34;compiled gelu: </span><span style="color:#7f8c8d">{</span><span style="color:#434f54">compiled_out</span><span style="color:#7f8c8d">}</span><span style="color:#7f8c8d">&#34;</span>)
</span></span></code></pre></div><h3 id="the-fast-sub-package">The fast sub-package</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">mlx.core</span> <span style="color:#728e00">as</span> <span style="color:#434f54">mx</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">def</span> <span style="color:#d35400">rms_norm</span>(<span style="color:#434f54">x</span>, <span style="color:#434f54">weight</span>, <span style="color:#434f54">eps</span><span style="color:#728e00">=</span><span style="color:#8a7b52">1e-5</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">y</span> <span style="color:#728e00">=</span> <span style="color:#434f54">x</span><span style="color:#728e00">.</span><span style="color:#434f54">astype</span>(<span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">float32</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">y</span> <span style="color:#728e00">=</span> <span style="color:#434f54">y</span> <span style="color:#728e00">*</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">rsqrt</span>(<span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">mean</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">square</span>(<span style="color:#434f54">y</span>), 
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">axis</span><span style="color:#728e00">=-</span><span style="color:#8a7b52">1</span>, 
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">keepdims</span><span style="color:#728e00">=</span><span style="color:#00979d">True</span>,
</span></span><span style="display:flex;"><span>    ) <span style="color:#728e00">+</span> <span style="color:#434f54">eps</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#728e00">return</span> (<span style="color:#434f54">weight</span> <span style="color:#728e00">*</span> <span style="color:#434f54">y</span>)<span style="color:#728e00">.</span><span style="color:#434f54">astype</span>(<span style="color:#434f54">x</span><span style="color:#728e00">.</span><span style="color:#434f54">dtype</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">batch_size</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">8192</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">feature_dim</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">4096</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">iterations</span> <span style="color:#728e00">=</span> <span style="color:#8a7b52">1000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">x</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">random</span><span style="color:#728e00">.</span><span style="color:#434f54">normal</span>([<span style="color:#434f54">batch_size</span>, <span style="color:#434f54">feature_dim</span>])
</span></span><span style="display:flex;"><span><span style="color:#434f54">weight</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">ones</span>(<span style="color:#434f54">feature_dim</span>)
</span></span><span style="display:flex;"><span><span style="color:#434f54">bias</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">zeros</span>(<span style="color:#434f54">feature_dim</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">start_time</span> <span style="color:#728e00">=</span> <span style="color:#434f54">time</span><span style="color:#728e00">.</span><span style="color:#434f54">perf_counter</span>()
</span></span><span style="display:flex;"><span><span style="color:#728e00">for</span> <span style="color:#434f54">_</span> <span style="color:#728e00">in</span> <span style="color:#728e00">range</span>(<span style="color:#434f54">iterations</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">y</span> <span style="color:#728e00">=</span> <span style="color:#434f54">rms_norm</span>(<span style="color:#434f54">x</span>, <span style="color:#434f54">weight</span>, <span style="color:#434f54">eps</span><span style="color:#728e00">=</span><span style="color:#8a7b52">1e-5</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">eval</span>(<span style="color:#434f54">y</span>)
</span></span><span style="display:flex;"><span><span style="color:#434f54">rms_norm_time</span> <span style="color:#728e00">=</span> <span style="color:#434f54">time</span><span style="color:#728e00">.</span><span style="color:#434f54">perf_counter</span>() <span style="color:#728e00">-</span> <span style="color:#434f54">start_time</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#7f8c8d">f</span><span style="color:#7f8c8d">&#34;rms_norm execution: </span><span style="color:#7f8c8d">{</span><span style="color:#434f54">gelu_time</span><span style="color:#7f8c8d">:</span><span style="color:#7f8c8d">0.4f</span><span style="color:#7f8c8d">}</span><span style="color:#7f8c8d"> sec&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">start_time</span> <span style="color:#728e00">=</span> <span style="color:#434f54">time</span><span style="color:#728e00">.</span><span style="color:#434f54">perf_counter</span>()
</span></span><span style="display:flex;"><span><span style="color:#728e00">for</span> <span style="color:#434f54">_</span> <span style="color:#728e00">in</span> <span style="color:#728e00">range</span>(<span style="color:#434f54">iterations</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">eval</span>(<span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">fast</span><span style="color:#728e00">.</span><span style="color:#434f54">rms_norm</span>(<span style="color:#434f54">x</span>, <span style="color:#434f54">weight</span>, <span style="color:#434f54">eps</span><span style="color:#728e00">=</span><span style="color:#8a7b52">1e-5</span>))
</span></span><span style="display:flex;"><span><span style="color:#434f54">fast_rms_norm_time</span> <span style="color:#728e00">=</span> <span style="color:#434f54">time</span><span style="color:#728e00">.</span><span style="color:#434f54">perf_counter</span>() <span style="color:#728e00">-</span> <span style="color:#434f54">start_time</span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#7f8c8d">f</span><span style="color:#7f8c8d">&#34;mx.fast.rms_norm execution: </span><span style="color:#7f8c8d">{</span><span style="color:#434f54">compiled_gelu_time</span><span style="color:#7f8c8d">:</span><span style="color:#7f8c8d">0.4f</span><span style="color:#7f8c8d">}</span><span style="color:#7f8c8d"> sec&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#7f8c8d">f</span><span style="color:#7f8c8d">&#34;mx.fast.rms_norm speedup: </span><span style="color:#7f8c8d">{</span><span style="color:#434f54">rms_norm_time</span><span style="color:#728e00">/</span><span style="color:#434f54">fast_rms_norm_time</span><span style="color:#7f8c8d">:</span><span style="color:#7f8c8d">0.2f</span><span style="color:#7f8c8d">}</span><span style="color:#7f8c8d">x&#34;</span>)
</span></span></code></pre></div><h2 id="custom-metal-kernals">Custom Metal Kernals</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">mlx.core</span> <span style="color:#728e00">as</span> <span style="color:#434f54">mx</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Build the kernel ------------start</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">source</span> <span style="color:#728e00">=</span> <span style="color:#7f8c8d">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">    uint elem = thread_position_in_grid.x;
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">    out[elem] = metal::exp(inp[elem]);
</span></span></span><span style="display:flex;"><span><span style="color:#7f8c8d">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">kernel</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">fast</span><span style="color:#728e00">.</span><span style="color:#434f54">metal_kernel</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">name</span><span style="color:#728e00">=</span><span style="color:#7f8c8d">&#34;myexp&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">input_names</span><span style="color:#728e00">=</span>[<span style="color:#7f8c8d">&#34;inp&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">output_names</span><span style="color:#728e00">=</span>[<span style="color:#7f8c8d">&#34;out&#34;</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">source</span><span style="color:#728e00">=</span><span style="color:#434f54">source</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Build the kernel ------------end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># Call the kernel on a sample input</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">x</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">array</span>([<span style="color:#8a7b52">1.0</span>, <span style="color:#8a7b52">2.0</span>, <span style="color:#8a7b52">3.0</span>])
</span></span><span style="display:flex;"><span><span style="color:#434f54">out</span> <span style="color:#728e00">=</span> <span style="color:#434f54">kernel</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">inputs</span><span style="color:#728e00">=</span>[<span style="color:#434f54">x</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">grid</span><span style="color:#728e00">=</span>(<span style="color:#434f54">x</span><span style="color:#728e00">.</span><span style="color:#434f54">size</span>, <span style="color:#8a7b52">1</span>, <span style="color:#8a7b52">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">threadgroup</span><span style="color:#728e00">=</span>(<span style="color:#8a7b52">256</span>, <span style="color:#8a7b52">1</span>, <span style="color:#8a7b52">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">output_shapes</span><span style="color:#728e00">=</span>[<span style="color:#434f54">x</span><span style="color:#728e00">.</span><span style="color:#434f54">shape</span>],
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">output_dtypes</span><span style="color:#728e00">=</span>[<span style="color:#434f54">x</span><span style="color:#728e00">.</span><span style="color:#434f54">dtype</span>],
</span></span><span style="display:flex;"><span>)[<span style="color:#8a7b52">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#728e00">print</span>(<span style="color:#434f54">out</span>)
</span></span></code></pre></div><h3 id="quantization">Quantization</h3>
<p>The size of arrays that we need for training is often much higher than what we
need for inference. Therefore, MLX provides ways to quantisize (reduce in size)
down from 32-bit floating point arrays into 16-bit floating point arrays, and even to 4-bit arrays.
For LLMs this can dramatically reduce the memory-use and increase the tokens/second.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#728e00">import</span> <span style="color:#434f54">mlx.core</span> <span style="color:#728e00">as</span> <span style="color:#434f54">mx</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">x</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">random</span><span style="color:#728e00">.</span><span style="color:#434f54">normal</span>([<span style="color:#8a7b52">1024</span>])
</span></span><span style="display:flex;"><span><span style="color:#434f54">weight</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">random</span><span style="color:#728e00">.</span><span style="color:#434f54">normal</span>([<span style="color:#8a7b52">1024</span>, <span style="color:#8a7b52">1024</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">quantized_weight</span>, <span style="color:#434f54">scales</span>, <span style="color:#434f54">biases</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">quantize</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#434f54">weight</span>, <span style="color:#434f54">bits</span><span style="color:#728e00">=</span><span style="color:#8a7b52">4</span>, <span style="color:#434f54">group_size</span><span style="color:#728e00">=</span><span style="color:#8a7b52">32</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">y</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">quantized_matmul</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">x</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">quantized_weight</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">scales</span><span style="color:#728e00">=</span><span style="color:#434f54">scales</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">biases</span><span style="color:#728e00">=</span><span style="color:#434f54">biases</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">bits</span><span style="color:#728e00">=</span><span style="color:#8a7b52">4</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">group_size</span><span style="color:#728e00">=</span><span style="color:#8a7b52">32</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">w_orig</span> <span style="color:#728e00">=</span> <span style="color:#434f54">mx</span><span style="color:#728e00">.</span><span style="color:#434f54">dequantize</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">quantized_weight</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">scales</span><span style="color:#728e00">=</span><span style="color:#434f54">scales</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">biases</span><span style="color:#728e00">=</span><span style="color:#434f54">biases</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">bits</span><span style="color:#728e00">=</span><span style="color:#8a7b52">4</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#434f54">group_size</span><span style="color:#728e00">=</span><span style="color:#8a7b52">32</span>,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#95a5a6"># We can also quantize a model using a single command:</span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">model</span> <span style="color:#728e00">=</span> <span style="color:#434f54">nn</span><span style="color:#728e00">.</span><span style="color:#434f54">Sequential</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">nn</span><span style="color:#728e00">.</span><span style="color:#434f54">Embedding</span>(<span style="color:#8a7b52">100</span>, <span style="color:#8a7b52">4</span>)<span style="color:#728e00">.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">nn</span><span style="color:#728e00">.</span><span style="color:#434f54">Linear</span>(<span style="color:#8a7b52">4</span>, <span style="color:#8a7b52">8</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">nn</span><span style="color:#728e00">.</span><span style="color:#434f54">Linear</span>(<span style="color:#8a7b52">8</span>, <span style="color:#8a7b52">8</span>),
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">nn</span><span style="color:#728e00">.</span><span style="color:#434f54">Linear</span>(<span style="color:#8a7b52">8</span>, <span style="color:#8a7b52">1</span>),
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#434f54">nn</span><span style="color:#728e00">.</span><span style="color:#434f54">quantize</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">model</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">bits</span><span style="color:#728e00">=</span><span style="color:#8a7b52">4</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#434f54">group_size</span><span style="color:#728e00">=</span><span style="color:#8a7b52">32</span>,
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div>



    </div>
    
    
  </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>'I write to understand as much as to be understood.' ‚ÄîElie Wiesel<br> (c) 2024 CryptoPatrick</p>
  </div>
</section>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.0/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>




</body>
